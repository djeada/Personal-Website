<!DOCTYPE html>

<html lang="pl">

<head>
    <script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5593122079896089"></script>
    <title>Wątki</title>
    <meta charset="utf-8" />
    <meta content="Wątki, pozwalają na równoległe wykonywanie się kilku fragmentów kodu." name="description" />
    <meta content="Adam Djellouli" name="keywords" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/themes/prism.min.css" rel="stylesheet" />
    <link href="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/icon.ico" rel="icon" />
    <link href="../resources/style.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="ie-edge" http-equiv="X-UA-Compatible" />
</head>

<body>
    <nav>
        <a class="logo" href="../index.html" title="Adam Djellouli - Home">
            <img alt="Adam Djellouli Logo" id="logo-image" src="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/logo.PNG" />
        </a>
        <input aria-label="Toggle navigation menu" id="navbar-toggle" type="checkbox" />
        <ul>
            <li> <a href="../index.html" title="Home"> Home </a> </li>
            <li> <a class="active" href="../core/blog.html" title="Adam Djellouli's Blog - Programming, technology and more"> Blog </a> </li>
            <li> <a href="../core/tools.html" title="Useful Tools by Adam Djellouli"> Tools </a> </li>
            <li> <a href="../core/projects.html" title="Projects by Adam Djellouli"> Projects </a> </li>
            <li> <a href="../core/resume.html" title="Adam Djellouli's Resume"> Resume </a> </li>
            <li> <a href="../core/about.html" title="About Adam Djellouli"> About </a> </li>
            <button aria-label="Toggle dark mode" id="dark-mode-button"></button>
        </ul>
    </nav>
    <section id="article-body"></section>
    <p style="text-align: right;"><i>This article is written in: 🇵🇱</i></p>
    <div id="article-wrapper">
        <section id="article-body">

            <h2 id="wątki">Wątki</h2>
            <p>Wątki, pozwalają na równoległe wykonywanie się kilku fragmentów kodu. Z tego powodu są szczególnie przydatne do obsługi zadań, które mogą zająć dużo czasu, np. łączenie się z zewnętrznym serwerem lub wczytywanie dużych plików. W ten sposób nie musimy czekać na zakończenie danego zadania, lecz możemy je wykonać równolegle z pozostałymi czynnościami.</p>
            <p>Aby skorzystać z wątków, należy najpierw zaimportować moduł <code>threading</code>. Następnie, aby utworzyć nowy wątek, należy utworzyć obiekt klasy <code>Thread</code>. Klasa ta przyjmuje jako argument funkcję, która będzie wykonana jako wątek.</p>
            <p>
            <div>
                <pre><code class="language-python">import threading
def watek():
    print("Watek")
w1 = threading.Thread(target=watek)</code></pre>
            </div>
            </p>
            <p>Aby uruchomić wątek, należy wywołać metodę <code>start</code> na obiekcie klasy <code>Thread</code>.</p>
            <p>
            <div>
                <pre><code class="language-python">w1.start()</code></pre>
            </div>
            </p>
            <p>Należy pamiętać, że wątki działają równolegle, więc nie ma gwarancji kolejności wykonywania się poszczególnych wątków. </p>
            <h3 id="własny-wątek">Własny wątek</h3>
            <p>Aby utworzyć wątek, należy stworzyć klasę dziedziczącą po klasie <code>Thread</code> z modułu <code>threading</code> i zdefiniować metodę <code>run</code>, która zostanie wywołana przy uruchomieniu wątku. Następnie należy utworzyć obiekt tej klasy i wywołać metodę <code>start</code>, aby rozpocząć działanie wątku.</p>
            <p>
            <div>
                <pre><code class="language-python">import threading
class MyThread(threading.Thread):
    def run(self):
        # kod, ktory zostanie wykonany w watku
        print("Wątek uruchomiony")
thread = MyThread()
thread.start()</code></pre>
            </div>
            </p>
            <p>Możemy również przekazać argumenty do metody <code>run</code> poprzez konstruktor klasy.</p>
            <p>
            <div>
                <pre><code class="language-python">import threading
class MyThread(threading.Thread):
    def __init__(self, argument):
        self.argument = argument
        super().init()
def run(self):
    # kod, ktory zostanie wykonany w watku
    print(f"Wątek uruchomiony z argumentem: {self.argument}")

thread = MyThread("Hello World")
thread.start()</code></pre>
            </div>
            </p>
            <h3 id="zatrzymanie-wątku">Zatrzymanie wątku</h3>
            <p>W Pythonie można zatrzymać wątek poprzez wywołanie metody <code>Thread.join()</code>. Ta metoda blokuje wywołujący wątek aż do momentu, gdy wątek do którego została wywołana zakończy swoje działanie. Przykładowo, jeśli chcemy zatrzymać główny wątek programu do momentu, gdy wszystkie wątki zostaną zakończone, możemy użyć pętli for i iterować po liście wątków i dla każdego z nich wywołać metodę <code>join()</code>:</p>
            <p>
            <div>
                <pre><code class="language-python">threads = [thread1, thread2, thread3]
for thread in threads:
    thread.join()</code></pre>
            </div>
            </p>
            <p>Można również użyć metody <code>Thread.join(timeout)</code> z opcjonalnym parametrem <code>timeout</code>. Parametr ten określa maksymalny czas oczekiwania na zakończenie wątku. Jeśli wątek nie zakończy działania w ciągu tego czasu, wątek wywołujący metodę <code>join()</code> zostanie wznowiony.</p>
            <p>Innym sposobem zatrzymania wątku jest użycie zmiennej globalnej <code>threading.Event</code> z metodami <code>wait()</code> i <code>set()</code>. Wątek, który chcemy zatrzymać, może oczekiwać na sygnał za pomocą metody <code>wait()</code>, a wątek główny może wysłać sygnał za pomocą metody <code>set()</code>. W przypadku użycia tej metody, wątek oczekujący może również ustawić opcjonalny limit czasu oczekiwania.</p>
            <p>
            <div>
                <pre><code class="language-python">import threading
# utworzenie zmiennej Event
stop_event = threading.Event()
def worker_thread():
    while not stop_event.is_set():
        # wątek wykonuje swoje zadania
        do_some_work()
    # po otrzymaniu sygnalu zatrzymujemy watek
    stop_event.clear()
# ...
# glowny watek chce zatrzymac worker_thread
stop_event.set()</code></pre>
            </div>
            </p>
            <p>Należy pamiętać, że zatrzymanie wątku nie jest powszechnie zalecaną metodą zarządzania wątkami. W wielu przypadkach lepszym rozwiązaniem jest użycie warunków synchronizacyjnych lub zamknięcia wątku za pomocą metody <code>join()</code>. Zatrzymanie wątku może powodować nieoczekiwane skutki uboczne i powinno być używane jedynie w wyjątkowych sytuacjach.</p>
            <h3 id="dzielenie-zasobów-między-wątkami">Dzielenie zasobów między wątkami</h3>
            <p>Dzielenie zasobów między wątkami polega na umożliwieniu kilku wątkom równoczesnego dostępu do wspólnego zasobu. W przypadku, gdy zasób jest zmienny, konieczne jest zapewnienie bezpieczeństwa jego dostępu, tzn. zapobiegnięcie sytuacji, w której kilka wątków będzie próbowało zmodyfikować ten sam zasób w tym samym czasie. Istnieją mechanizmy umożliwiające bezpieczne dzielenie zasobów między wątkami, takie jak obiekt <code>Lock</code>.</p>
            <p>Przykład:</p>
            <p>
            <div>
                <pre><code class="language-python">import threading
# Zmienna globalna, do której będą miały dostęp wątki
zmienna_globalna = 0
# Obiekt Lock, który będziemy używali do synchronizacji dostępu do zmiennej globalnej
lock = threading.Lock()
def watek1():
    global zmienna_globalna
    for i in range(100):
    # Pobieramy lock, aby mieć pewność, że tylko jeden wątek będzie
    # miał dostęp do zmiennej globalnej w danym momencie
    lock.acquire()
    zmienna_globalna += 1
    lock.release()
def watek2():
    global zmienna_globalna
    for i in range(100):
    # Pobieramy lock, aby mieć pewność, że tylko jeden wątek będzie
    # miał dostęp do zmiennej globalnej w danym momencie
    lock.acquire()
    zmienna_globalna -= 1
    lock.release()
# Uruchamiamy wątki
t1 = threading.Thread(target=watek1)
t2 = threading.Thread(target=watek2)
t1.start()
t2.start()
# Czekamy na zakończenie obu wątków
t1.join()
t2.join()
# Wypisujemy wartość zmiennej globalnej
print(zmienna_globalna)</code></pre>
            </div>
            </p>
            <p>W tym przykładzie mamy dwie funkcje <code>watek1</code> i <code>watek2</code>, które zmieniają wartość zmiennej globalnej <code>zmienna_globalna</code>. Aby zapewnić bezpieczne dzielenie zasobów między wątkami, użyto mechanizmu blokady. </p>
            <h3 id="gil">GIL</h3>
            <p>GIL, czyli Global Interpreter Lock, to mechanizm, który ogranicza możliwość jednoczesnego wykonywania kodu przez wiele wątków. W Pythonie każdy wątek jest obsługiwany przez GIL, który kontroluje dostęp do interpretera. W rezultacie tylko jeden wątek jest w stanie wykonywać kod naraz, a pozostałe są zawieszane aż do momentu, gdy GIL zostanie zwolniony.</p>
            <p>GIL jest wbudowanym mechanizmem w Pythonie, który został dodany w celu uniknięcia problemów związanych z współdzieleniem zasobów przez wiele wątków. Chociaż GIL może mieć pewne ograniczenia w przypadku bardzo obciążających procesów wielowątkowych, w większości przypadków jest on wystarczający do obsługi równoległości w Pythonie.</p>
            <p>Przykładowo, jeśli chcielibyśmy utworzyć program, który będzie sumował elementy w liście, możemy to zrobić za pomocą wielu wątków. Każdy wątek będzie odpowiedzialny za sumowanie części listy. Niestety, GIL spowoduje, że tylko jeden wątek będzie wykonywany w danym momencie, co spowolni działanie programu.</p>
            <p>Oto przykład programu sumującego elementy w liście z użyciem wątków:</p>
            <p>
            <div>
                <pre><code class="language-python">import threading
def sum_list(numbers):
    # Funkcja sumująca elementy w liście
    total = 0
    for number in numbers:
        total += number
    print(total)
# Utworzenie wątków
thread1 = threading.Thread(target=sum_list, args=([1, 2, 3],))
thread2 = threading.Thread(target=sum_list, args=([4, 5, 6],))
thread3 = threading.Thread(target=sum_list, args=([7, 8, 9],))
# Uruchomienie wątków
thread1.start()
thread2.start()
thread3.start()
# Oczekiwanie na zakończenie wątków
thread1.join()
thread2.join()
thread3.join()</code></pre>
            </div>
            </p>
            <p>W powyższym przykładzie, chociaż mamy trzy wątki, GIL spowoduje, że tylko jeden z nich będzie wykonywany w danym momencie, co sprawi że użycie wątków nie pomoże z przyspieszeniem działania progrmau.</p>
        </section>
        <div id="table-of-contents">
            <h2>Table of Contents</h2>
            <ol>
                <li><a href="#wątki">Wątki</a></li>
                <li><a href="#własny-wątek">Własny wątek</a></li>
                <li><a href="#zatrzymanie-wątku">Zatrzymanie wątku</a></li>
                <li><a href="#dzielenie-zasobów-między-wątkami">Dzielenie zasobów między wątkami</a></li>
                <li><a href="#gil">GIL</a></li>
            </ol>
        </div>
    </div>
    <footer>
        <div class="footer-columns">
            <div class="footer-column">
                <img alt="Adam Djellouli Symbol" src="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/symbol.png" />
            </div>
            <div class="footer-column">
                <h2><a href="https://adamdjellouli.com/core/privacy_policy.html" title="Privacy Policy">Our Privacy Policy</a></h2>
                <p>
                    Thank you for visiting my personal website. All of the <br />
                    content on this site is free to use, but please remember <br />
                    to be a good human being and refrain from any abuse<br />
                    of the site. If you would like to contact me, please use <br />
                    my <a href="https://www.linkedin.com/in/adam-djellouli-1bb54619a/" title="LinkedIn Profile">LinkedIn profile</a> or my <a href="https://github.com/djeada" title="GitHub Profile">GitHub</a> if you have any technical <br />
                    issues or ideas to share. I wish you the best and hope you <br />
                    have a fantastic life. <br />
                </p>
            </div>
            <div class="footer-column">
                <h2>Follow me</h2>
                <ul class="social-media">
                    <li>
                        <a class="fa fa-youtube" href="https://www.youtube.com/channel/UCGPoHTVjMN77wcGknXPHl1Q" target="_blank" title="YouTube">
                        </a>YouTube
                    </li>
                    <li>
                        <a class="fa fa-linkedin" href="https://www.linkedin.com/in/adam-djellouli-1bb54619a/" target="_blank" title="LinkedIn">
                        </a>LinkedIn
                    </li>
                    <li>
                        <a class="fa fa-instagram" href="https://www.instagram.com/addjellouli/" target="_blank" title="Instagram">
                        </a>Instagram
                    </li>
                    <li>
                        <a class="fa fa-github" href="https://github.com/djeada" title="GitHub">
                        </a>Github
                    </li>
                </ul>
            </div>
        </div>
        <div>
            <p id="copyright">
                © Adam Djellouli. All rights reserved.
            </p>
        </div>
        <script>
            document.getElementById("copyright").innerHTML = "&copy; " + new Date().getFullYear() + " Adam Djellouli. All rights reserved.";
        </script>
        <script src="../app.js"></script>
    </footer>
</body>

</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-python.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
jax: ["input/TeX", "output/HTML-CSS"],
extensions: ["tex2jax.js"],
"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] },
tex2jax: { inlineMath: [ ["$", "$"] ], displayMath: [ ["$$","$$"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
TeX: { noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } } },
messageStyle: "none"
});
</script>
<script async="" id="MathJax-script" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>