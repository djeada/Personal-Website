<!DOCTYPE html>

<html lang="en">

<head>
    <script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5593122079896089"></script>
    <meta charset="utf-8" />
    <title>Handling the Double-Booking Problem in Databases</title>
    <meta content="The double-booking problem is a common issue in database systems, particularly in applications like booking platforms, reservation systems, and inventory management." name="description" />
    <meta content="Adam Djellouli" name="author" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <link crossorigin="" href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/themes/prism.min.css" rel="stylesheet" />
    <link href="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/icon.ico" rel="icon" />
    <link href="../../../resources/style.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/04_double_booking_problem" rel="canonical" />
    <script id="structured-data" type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Article",
            "headline": "Handling the Double-Booking Problem in Databases",
            "author": {
                "@type": "Person",
                "name": "Adam Djellouli"
            },
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/04_double_booking_problem"
            },
            "url": "https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/04_double_booking_problem",
            "description": "The double-booking problem is a common issue in database systems, particularly in applications like booking platforms, reservation systems, and inventory management.",
            "dateModified": "2017-03-27"
        }
    </script>
</head>

<body>
    <nav aria-label="Main navigation">
        <a class="logo" href="../../../index.html">
            <img alt="Adam Djellouli - Home Page Logo" id="logo-image" src="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/logo.PNG" />
        </a>
        <input aria-label="Toggle navigation menu" id="navbar-toggle" type="checkbox" />
        <ul aria-labelledby="navbar-toggle" role="menu">
            <li role="menuitem">
                <a href="../../../index.html" title="Go to Home Page"> Home </a>
            </li>
            <li role="menuitem">
                <a href="../../../core/blog.html" title="Read Adam Djellouli Blog on Programming and Technology"> Blog </a>
            </li>
            <li role="menuitem">
                <a href="../../../core/tools.html" title="Discover Tools Created by Adam Djellouli"> Tools </a>
            </li>
            <li role="menuitem">
                <a href="../../../core/projects.html" title="Explore Projects Developed by Adam Djellouli"> Projects </a>
            </li>
            <li role="menuitem">
                <a href="../../../core/courses.html" title="Browse Courses by Adam Djellouli"> Courses </a>
            </li>
            <li role="menuitem">
                <a href="../../../core/resume.html" title="View Adam Djellouli Professional Resume"> Resume </a>
            </li>
            <li>
                <script async="" src="https://cse.google.com/cse.js?cx=8160ef9bb935f4f68"></script>
                <div class="gcse-search"></div>
            </li>
            <li>
                <button aria-label="Toggle dark mode" id="dark-mode-button"></button>
            </li>
        </ul>
    </nav>
    <div id="article-wrapper">
        <aside id="article-sidebar">
            <div id="table-of-contents">
                <h2>Table of Contents</h2>
                <ol><a href="#handling-the-double-booking-problem-in-databases">Handling the Double-Booking Problem in Databases</a>
                    <ol>
                        <li><a href="#understanding-the-double-booking-problem">Understanding the Double-Booking Problem</a></li>
                        <li><a href="#causes-of-the-double-booking-problem">Causes of the Double-Booking Problem</a></li>
                        <li><a href="#preventing-double-booking">Preventing Double-Booking</a>
                            <ol>
                                <li><a href="#use-the-right-lock-for-the-situation">Use the Right Lock for the Situation</a></li>
                                <li><a href="#pick-an-isolation-level-you-can-live-with">Pick an Isolation Level You Can Live With</a></li>
                                <li><a href="#optimistic-concurrency-control-occ-">Optimistic Concurrency Control (OCC)</a></li>
                                <li><a href="#pessimistic-lock-first-work-later">Pessimistic Lock First, Work Later</a></li>
                                <li><a href="#enforce-invariants-with-constraints-indexes">Enforce Invariants with Constraints &amp; Indexes</a></li>
                                <li><a href="#consistent-lock-ordering-to-avoid-deadlocks">Consistent Lock Ordering to Avoid Deadlocks</a></li>
                            </ol>
                        </li>
                        <li><a href="#monitor-tune-locking-in-production">Monitor &amp; Tune Locking in Production</a>
                            <ol>
                                <li><a href="#why-you-watch">Why you watch</a></li>
                                <li><a href="#instant-health-check-queries-engine-specifics-">Instant health-check queries (engine specifics)</a></li>
                                <li><a href="#alert-thresholds-that-catch-trouble-early-tune-for-your-sla-">Alert thresholds that catch trouble early (tune for your SLA)</a></li>
                                <li><a href="#when-an-alert-fires-triage-playbook">When an alert fires‚Äîtriage playbook</a></li>
                                <li><a href="#automating-the-watch">Automating the watch</a></li>
                                <li><a href="#continuous-improvement-loop">Continuous improvement loop</a></li>
                            </ol>
                        </li>
                        <li><a href="#real-world-example-ticket-booking-system">Real-World Example: Ticket Booking System</a>
                            <ol>
                                <li><a href="#stack-prerequisites">Stack &amp; prerequisites</a></li>
                                <li><a href="#build-a-miniature-ticket-system">Build a miniature ticket system</a></li>
                                <li><a href="#reproduce-the-double-booking-bug">Reproduce the double-booking bug</a></li>
                                <li><a href="#prevent-it-pessimistic-locking-">Prevent it (pessimistic locking)</a></li>
                                <li><a href="#at-a-glance-equivalents-in-other-engines">At a glance: equivalents in other engines</a></li>
                                <li><a href="#alternative-optimistic-locking">Alternative: optimistic locking</a></li>
                                <li><a href="#quick-checklist-for-your-project">Quick checklist for your project</a></li>
                            </ol>
                        </li>
                    </ol>
                </ol>
            </div>
            <div id="related-articles">
                <h2>Related Articles</h2>
                <ol>
                    <li>Introduction to Databases<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/01_introduction_to_databases/01_databases_intro.html">Databases Intro</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/01_introduction_to_databases/02_types_of_databases.html">Types of Databases</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/01_introduction_to_databases/03_database_management_systems_dbms_.html">Database Management Systems Dbms</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/01_introduction_to_databases/04_data_models.html">Data Models</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/01_introduction_to_databases/05_glossary.html">Glossary</a></li>
                        </ol>
                    </li>
                    <li>Database Design<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/02_database_design/01_requirements_analysis.html">Requirements Analysis</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/02_database_design/02_normalization.html">Normalization</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/02_database_design/03_denormalization.html">Denormalization</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/02_database_design/04_indexing_strategies.html">Indexing Strategies</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/02_database_design/05_data_integrity.html">Data Integrity</a></li>
                        </ol>
                    </li>
                    <li>Sql<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/01_intro_to_sql.html">Intro to Sql</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/02_data_definition_language_ddl.html">Data Definition Language Ddl</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/03_data_manipulation_language_dml.html">Data Manipulation Language Dml</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/04_data_control_language_dcl.html">Data Control Language Dcl</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/05_transaction_control_language_tcl.html">Transaction Control Language Tcl</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/06_joins_subqueries_and_views.html">Joins Subqueries and Views</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/07_stored_procedures_and_functions.html">Stored Procedures and Functions</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/08_triggers.html">Triggers</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/09_hierarchical_data.html">Hierarchical Data</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/10_aggregate_functions.html">Aggregate Functions</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/11_window_functions.html">Window Functions</a></li>
                        </ol>
                    </li>
                    <li>Acid Properties and Transactions<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/04_acid_properties_and_transactions/01_transactions_intro.html">Transactions Intro</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/04_acid_properties_and_transactions/02_atomicity.html">Atomicity</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/04_acid_properties_and_transactions/03_consistency.html">Consistency</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/04_acid_properties_and_transactions/04_isolation.html">Isolation</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/04_acid_properties_and_transactions/05_durability.html">Durability</a></li>
                        </ol>
                    </li>
                    <li>Storage and Indexing<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/05_storage_and_indexing/01_how_tables_and_indexes_are_stored_on_disk.html">How Tables and Indexes Are Stored on Disk</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/05_storage_and_indexing/02_row_based_vs_column_based_databases.html">Row Based vs Column Based Databases</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/05_storage_and_indexing/03_primary_key_vs_secondary_key.html">Primary Key vs Secondary Key</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/05_storage_and_indexing/04_database_pages.html">Database Pages</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/05_storage_and_indexing/05_indexing.html">Indexing</a></li>
                        </ol>
                    </li>
                    <li>Distributed Databases<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/01_distributed_database_systems.html">Distributed Database Systems</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/02_partitioning.html">Partitioning</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/03_sharding.html">Sharding</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/04_partitioning_vs_sharding.html">Partitioning vs Sharding</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/05_consistent_hashing.html">Consistent Hashing</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/06_cap_theorem.html">Cap Theorem</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/07_eventual_consistency.html">Eventual Consistency</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/08_distributed_database_systems.html">Distributed Database Systems</a></li>
                        </ol>
                    </li>
                    <li>Concurrency Control<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/01_shared_vs_exclusive_locks.html">Shared vs Exclusive Locks</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/02_deadlocks.html">Deadlocks</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/03_two_phase_locking.html">Two Phase Locking</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/04_double_booking_problem.html">Double Booking Problem</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/05_serializable_vs_repeatable_read.html">Serializable vs Repeatable Read</a></li>
                        </ol>
                    </li>
                    <li>Database Performance<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/01_query_optimization_techniques.html">Query Optimization Techniques</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/02_indexing_strategies.html">Indexing Strategies</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/03_database_caching.html">Database Caching</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/04_materialized_views.html">Materialized Views</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/05_accessing_database_in_code.html">Accessing Database in Code</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/06_working_with_billion_row_table.html">Working with Billion Row Table</a></li>
                        </ol>
                    </li>
                    <li>Database Replication<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/09_database_replication/01_intro_to_replication.html">Intro to Replication</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/09_database_replication/02_master_standby_replication.html">Master Standby Replication</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/09_database_replication/03_multi_master_replication.html">Multi Master Replication</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/09_database_replication/04_synchronous_vs_asynchronous_replication.html">Synchronous vs Asynchronous Replication</a></li>
                        </ol>
                    </li>
                    <li>Nosql Databases<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/10_nosql_databases/01_nosql_databases_intro.html">Nosql Databases Intro</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/10_nosql_databases/02_types_of_nosql_databases.html">Types of Nosql Databases</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/10_nosql_databases/03_querying_nosql_databases.html">Querying Nosql Databases</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/10_nosql_databases/04_crud_in_sql_vs_nosql.html">Crud in Sql vs Nosql</a></li>
                        </ol>
                    </li>
                    <li>Security Best Practices<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/01_backup_and_recovery_strategies.html">Backup and Recovery Strategies</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/02_database_security.html">Database Security</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/03_capacity_planning.html">Capacity Planning</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/04_database_migration.html">Database Migration</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/05_performance_monitoring_and_tuning.html">Performance Monitoring and Tuning</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/06_sql_injection.html">Sql Injection</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/07_crash_recovery_in_databases.html">Crash Recovery in Databases</a></li>
                        </ol>
                    </li>
                    <li>Database Engines<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/01_sqlite.html">Sqlite</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/02_mysql.html">Mysql</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/03_postgresql.html">Postgresql</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/04_mongodb.html">Mongodb</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/05_neo4j.html">Neo4J</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/06_aws_services.html">Aws Services</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/07_choosing_database.html">Choosing Database</a></li>
                        </ol>
                    </li>
                </ol>
            </div>
        </aside><article-section id="article-body">
            <div class="article-action-buttons"><button class="btn-suggest-edit" title="Suggest Edit">
                    <svg fill="none" height="20" viewbox="0 0 24 24" width="20">
                        <path d="M4 21h4l11-11-4-4L4 17v4z" stroke="currentColor" stroke-width="2"></path>
                    </svg>
                </button><button class="btn-create-issue" title="Create Issue">
                    <svg fill="none" height="20" viewbox="0 0 24 24" width="20">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"></circle>
                        <line stroke="currentColor" stroke-width="2" x1="12" x2="12" y1="8" y2="12"></line>
                        <circle cx="12" cy="16" fill="currentColor" r="1"></circle>
                    </svg>
                </button><button class="btn-download" title="Download">
                    <svg fill="none" height="20" viewbox="0 0 24 24" width="20">
                        <path d="M12 5v14m0 0l-6-6m6 6l6-6" stroke="currentColor" stroke-width="2"></path>
                    </svg>
                </button></div>
            <p style="text-align: right;"><i>Last modified: March 27, 2017</i></p>
            <p style="text-align: right;"><i>This article is written in: üá∫üá∏</i></p>
            <h2 id="handling-the-double-booking-problem-in-databases">Handling the Double-Booking Problem in Databases</h2>
            <p>The double-booking problem is a common issue in database systems, particularly in applications like booking platforms, reservation systems, and inventory management. It occurs when multiple transactions simultaneously attempt to reserve or modify the same resource, leading to conflicts and inconsistencies. This can result in overbooked flights, double-sold tickets, or oversold inventory, causing significant problems for both businesses and customers.</p>
            <p>After reading the material, you should be able to answer the following questions:</p>
            <ol>
                <li>What is the double-booking problem in database systems, and in which types of applications is it commonly encountered?</li>
                <li>What are the primary causes of the double-booking problem, such as race conditions and inadequate locking mechanisms?</li>
                <li>How do shared and exclusive locks help prevent the double-booking problem, and what is the difference between them?</li>
                <li>What concurrency control strategies can be implemented to avoid double-booking, including proper locking, setting appropriate isolation levels, and using optimistic concurrency control?</li>
                <li>What are some best practices for designing transactions and managing locks to minimize the risk of double-booking in high-concurrency environments?</li>
            </ol>
            <h3 id="understanding-the-double-booking-problem">Understanding the Double-Booking Problem</h3>
            <p>At its core, the double-booking problem arises due to concurrent transactions accessing and modifying shared resources without proper synchronization. When two or more transactions read the same data and proceed to update it based on the initial value, they can inadvertently overwrite each other's changes.</p>
            <p><strong>Illustrative Scenario:</strong></p>
            <p>Imagine two customers, Alice and Bob, trying to book the last available seat on a flight at the same time.</p>
            <div>
                <pre><code class="language-shell">Time    Transaction by Alice            Transaction by Bob
--------------------------------------------------------------
T1      Read available seats = 1
T2                                      Read available seats = 1
T3      Book seat (available seats = 0)
T4                                      Book seat (available seats = -1)</code></pre>
            </div>
            <p>In this timeline:</p>
            <ul>
                <li>At <strong>T1</strong>, Alice's transaction reads that there is <strong>1 seat available</strong>.</li>
                <li>At <strong>T2</strong>, Bob's transaction also reads <strong>1 seat available</strong>.</li>
                <li>At <strong>T3</strong>, Alice books the seat, updating the available seats to <strong>0</strong>.</li>
                <li>At <strong>T4</strong>, Bob, unaware of Alice's booking, also books the seat, reducing the available seats to <strong>-1</strong>.</li>
            </ul>
            <p>This results in an overbooking situation where the system has allowed more bookings than available seats.</p>
            <h3 id="causes-of-the-double-booking-problem">Causes of the Double-Booking Problem</h3>
            <p>Several factors contribute to the occurrence of double-booking in databases:</p>
            <ul>
                <li>The presence of <strong>race conditions</strong> allows transactions to operate on the same data concurrently without proper synchronization, resulting in unpredictable and conflicting outcomes. </li>
                <li><strong>Inadequate locking mechanisms</strong> fail to restrict access effectively, enabling multiple transactions to simultaneously read and write to the same resource, leading to inconsistencies. </li>
                <li>Utilizing <strong>insufficient isolation levels</strong>, such as read-uncommitted, permits undesirable phenomena like dirty reads and non-repeatable reads, increasing the likelihood of data conflicts. </li>
                <li><strong>Delayed writes</strong> occur when transactions read data, perform computations, and then write back changes after a delay, potentially overwriting updates made by other transactions in the interim. </li>
            </ul>
            <h3 id="preventing-double-booking">Preventing Double-Booking</h3>
            <p>Preventing double-booking is essential for systems where concurrent users compete for limited resources. By implementing proper locking strategies and transaction controls, you can ensure data integrity and provide a reliable user experience even under high concurrency.</p>
            <h4 id="use-the-right-lock-for-the-situation">Use the Right Lock for the Situation</h4>
            <p>Locks allow you to control how multiple transactions interact with the same data. Choosing the right lock type helps balance concurrency and safety: exclusive locks prevent other operations from interfering, while shared locks permit safe reads from multiple transactions.</p>
            <p>
            <table>
                <tr>
                    <td>Lock type</td>
                    <td>What it does</td>
                    <td>Works in</td>
                    <td>Typical syntax</td>
                    <td>How to verify</td>
                </tr>
                <tr>
                    <td><strong>Exclusive / Write</strong></td>
                    <td>One writer, no readers.</td>
                    <td>PostgreSQL, MySQL (InnoDB), SQL Server, Oracle</td>
                    <td><code>SELECT ‚Ä¶ FOR UPDATE;</code> (PG/MariaDB)<br /><code>SELECT ‚Ä¶ LOCK IN SHARE MODE;</code> (MySQL 8.0+)<br /><code>SELECT ‚Ä¶ WITH (UPDLOCK, HOLDLOCK);</code> (SQL Server)</td>
                    <td>Open two sessions. In session A run the locking <code>SELECT</code>. In session B run the same statement‚Äîobserve it block (PG/SQL Server) or return instantly with an error (MySQL w/ NOWAIT).</td>
                </tr>
                <tr>
                    <td><strong>Shared / Read</strong></td>
                    <td>Many readers, no writers.</td>
                    <td>Same engines as above</td>
                    <td><code>SELECT ‚Ä¶ FOR SHARE;</code> (PG)<br /><code>LOCK TABLE tbl IN SHARE MODE;</code> (MySQL)<br /><code>SELECT ‚Ä¶ WITH (HOLDLOCK);</code> (SQL Server)</td>
                    <td>Keep session A busy with <code>SELECT ‚Ä¶ FOR SHARE</code>, attempt an <code>UPDATE</code> in session B‚Äîupdate waits until session A commits.</td>
                </tr>
            </table>
            </p>
            <blockquote>
                <p><strong>Tip for PostgreSQL:</strong> Inspect current locks with</p>
                <div>
                    <pre><code class="language-sql">&gt; SELECT pid, locktype, relation::regclass, mode, granted
&gt; FROM pg_locks l JOIN pg_stat_activity a USING(pid);
&gt;</code></pre>
                </div>
            </blockquote>
            <h4 id="pick-an-isolation-level-you-can-live-with">Pick an Isolation Level You Can Live With</h4>
            <p>Isolation levels define how visible changes in one transaction are to others. Stricter levels prevent more anomalies but can reduce performance by increasing locking and blocking. Choose the level that meets your consistency needs without unnecessarily hindering throughput.</p>
            <p>
            <table>
                <tr>
                    <td>Level</td>
                    <td>Guarantees</td>
                    <td>Supported by</td>
                    <td>Set with</td>
                    <td>Quick test</td>
                </tr>
                <tr>
                    <td><strong>SERIALIZABLE</strong></td>
                    <td>No dirty, non-repeatable or phantom reads. Behaves as if transactions ran one-after-another.</td>
                    <td>PostgreSQL, SQL Server, Oracle, MySQL 8.0 (but uses extra locks ‚Üí lower concurrency)</td>
                    <td><code>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;</code></td>
                    <td>In two sessions insert into the same over-booked seat; one will roll back with <code>SQLSTATE 40001</code> (PG) or <code>ERROR 1213 (MySQL)</code>.</td>
                </tr>
                <tr>
                    <td><strong>REPEATABLE READ</strong></td>
                    <td>Same row value every time you read it; phantoms still possible (unless engine adds gap locks, e.g. MySQL). Default in MySQL.</td>
                    <td>PostgreSQL, MySQL (InnoDB), MariaDB, SQL Server (<code>SNAPSHOT</code>)</td>
                    <td><code>SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;</code></td>
                    <td>Read seat count twice in one Tx while another session inserts a new seat. In MySQL you won‚Äôt see new rows (gap locks); in PostgreSQL you will‚Äîso use explicit <code>SELECT ‚Ä¶ FOR KEY SHARE</code> to block.</td>
                </tr>
            </table>
            </p>
            <p><em>Verification script for MySQL</em></p>
            <div>
                <pre><code class="language-sql">-- Session A
SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;
START TRANSACTION;
SELECT * FROM seats WHERE seat_id = 42 FOR UPDATE;

-- Session B (should block or fail)
START TRANSACTION;
UPDATE seats SET user_id = 99 WHERE seat_id = 42;</code></pre>
            </div>
            <h4 id="optimistic-concurrency-control-occ-">Optimistic Concurrency Control (OCC)</h4>
            <p>When conflicts are rare, OCC lets you avoid heavy locking by using a version or timestamp column to detect concurrent updates. If a conflict is detected at commit time, the transaction retries, yielding higher throughput under low contention.</p>
            <div>
                <pre><code class="language-sql">-- Works in: PostgreSQL, SQL Server (rowversion/timestamp), MySQL (generated col), Oracle
BEGIN;
SELECT quantity, version
FROM inventory
WHERE product_id = 101;

-- business logic here ‚Ä¶

UPDATE inventory
SET quantity = :new_qty,
    version  = version + 1
WHERE product_id = 101
  AND version   = :old_version;      -- fails (0 rows) if someone changed it
COMMIT;</code></pre>
            </div>
            <p><em>Verify it</em>:</p>
            <ol>
                <li>Run above block in two psql sessions simultaneously.</li>
                <li>One commit succeeds, the other sees <code>UPDATE 0</code>, signaling a retry.</li>
            </ol>
            <h4 id="pessimistic-lock-first-work-later">Pessimistic Lock First, Work Later</h4>
            <p>Sometimes you need to lock resources immediately to prevent any concurrent modifications. This approach acquires an exclusive lock up front, ensuring that no one else can read or write the locked rows until you commit.</p>
            <div>
                <pre><code class="language-sql">-- SQL Server style
BEGIN TRAN;
SELECT * FROM seats
    WITH (UPDLOCK, HOLDLOCK)        -- upgrade immediately
    WHERE seat_id = 101;
/* proceed with booking */
COMMIT;</code></pre>
            </div>
            <ul>
                <li><strong>Where this shines:</strong> hotel room or flight-seat tables during a flash sale.</li>
                <li><strong>Where it hurts:</strong> large report queries (locks too many rows &amp; slows everyone).</li>
                <li><strong>Verification:</strong> Watch <code>sys.dm_tran_locks</code>; you‚Äôll see an <code>X</code> lock on that row.</li>
            </ul>
            <h4 id="enforce-invariants-with-constraints-indexes">Enforce Invariants with Constraints &amp; Indexes</h4>
            <p>Constraints and indexes enforce business rules at the database level, preventing invalid or conflicting data regardless of application logic. They serve as a final safety net against double-booking and other anomalies.</p>
            <p>
            <table>
                <tr>
                    <td>Technique</td>
                    <td>Engines</td>
                    <td>Sample SQL</td>
                    <td>How to test</td>
                </tr>
                <tr>
                    <td><strong>Unique constraint</strong> on <code>(seat_number, flight_id)</code></td>
                    <td>All relational DBs; MongoDB via unique index</td>
                    <td><code>ALTER TABLE bookings ADD CONSTRAINT u_flight_seat UNIQUE(seat_number, flight_id);</code></td>
                    <td>Insert same seat twice ‚áí expect <code>ERROR: duplicate key value violates unique constraint</code>.</td>
                </tr>
                <tr>
                    <td><strong>Check constraint</strong> to keep counters ‚â• 0</td>
                    <td>PostgreSQL, SQL Server, Oracle, MySQL 8.0+</td>
                    <td><code>ALTER TABLE flights ADD CONSTRAINT chk_available_seats CHECK (available_seats &gt;= 0);</code></td>
                    <td>Try manual <code>UPDATE flights SET available_seats = -1</code> ‚áí fails.</td>
                </tr>
                <tr>
                    <td><strong>Partial / filtered unique index</strong> to ignore cancelled tickets</td>
                    <td>PostgreSQL, SQL Server</td>
                    <td><code>CREATE UNIQUE INDEX u_active_seat ON bookings(seat,flight_id) WHERE status='CONFIRMED';</code></td>
                    <td>Insert two rows with <code>status='CONFIRMED'</code> ‚áí second insert fails.</td>
                </tr>
            </table>
            </p>
            <h4 id="consistent-lock-ordering-to-avoid-deadlocks">Consistent Lock Ordering to Avoid Deadlocks</h4>
            <p>Deadlocks occur when transactions lock resources in different orders. By enforcing a global lock acquisition order in all your transactions, you eliminate the circular dependencies that lead to deadlocks.</p>
            <ol>
                <li>Decide on a global order (e.g., always lock <code>flights</code> before <code>seats</code>).</li>
                <li>Code every transaction to follow that order.</li>
                <li><strong>Verify:</strong> turn on deadlock logging (<code>log_lock_waits=on</code> in PostgreSQL) and run parallel stress tests; no deadlocks should appear.</li>
            </ol>
            <h3 id="monitor-tune-locking-in-production">Monitor &amp; Tune Locking in Production</h3>
            <p><em>Proactive, continuous monitoring is the cheapest insurance you can buy against ‚Äúeverything-is-stuck‚Äù incidents. The goal is to notice lock contention </em><em>while it is still a warning sign</em><em>‚Äîlong before users start calling, background jobs fall behind, or an outage page lights up.</em></p>
            <h4 id="why-you-watch">Why you watch</h4>
            <p>
            <table>
                <tr>
                    <td>What you‚Äôre looking for</td>
                    <td>Why it matters</td>
                    <td>Typical symptom in the app</td>
                </tr>
                <tr>
                    <td><strong>Long-running transactions</strong></td>
                    <td>They hold locks far beyond the ‚Äúpolite‚Äù window, slowing everyone else.</td>
                    <td>Pages hang, batch jobs back up.</td>
                </tr>
                <tr>
                    <td><strong>Lock-wait time &amp; blocked sessions</strong></td>
                    <td>Indicates immediate pain and the exact sessions involved.</td>
                    <td>Sudden latency spikes.</td>
                </tr>
                <tr>
                    <td><strong>Deadlocks</strong></td>
                    <td>Proof the workload has crossed a concurrency threshold where simple waiting will never resolve.</td>
                    <td>Intermittent 400/500 errors, rolled-back work.</td>
                </tr>
                <tr>
                    <td><strong>Changing hotspot objects</strong></td>
                    <td>Which tables/rows/indexes get hotter over time?</td>
                    <td>Emerging scalability bottlenecks.</td>
                </tr>
            </table>
            </p>
            <h4 id="instant-health-check-queries-engine-specifics-">Instant health-check queries (engine specifics)</h4>
            <p>
            <table>
                <tr>
                    <td>Engine</td>
                    <td>Handy views / commands</td>
                    <td>What to keep on the big screen</td>
                    <td>Sample ‚Äúgrab-it-now‚Äù query</td>
                </tr>
                <tr>
                    <td><strong>PostgreSQL</strong></td>
                    <td><code>pg_stat_activity</code>, <code>pg_locks</code>, <code>pg_blocking_pids()</code></td>
                    <td>‚Ä¢ Active vs idle in txn<br />‚Ä¢ <code>wait_event = lock</code> count<br />‚Ä¢ Blocking tree</td>
                    <td><code>SELECT pid, state, now() - xact_start AS age, wait_event_type, wait_event, query FROM pg_stat_activity WHERE state = 'active' AND now() - xact_start &gt; interval '30s';</code></td>
                </tr>
                <tr>
                    <td><strong>SQL Server</strong></td>
                    <td><code>sys.dm_exec_sessions</code>, <code>sys.dm_exec_requests</code>, <code>sys.dm_tran_locks</code>, <code>sys.dm_os_waiting_tasks</code></td>
                    <td>‚Ä¢ <code>waiting_tasks_count</code> on <strong>LCK_</strong>* waits<br />‚Ä¢ Top blockers from <code>sys.dm_exec_sessions</code></td>
                    <td><code>SELECT TOP 10 blocking_session_id, wait_time_ms, wait_type, [text] FROM sys.dm_exec_requests CROSS APPLY sys.dm_exec_sql_text(sql_handle) WHERE blocking_session_id &lt;&gt; 0 ORDER BY wait_time_ms DESC;</code></td>
                </tr>
                <tr>
                    <td><strong>MySQL / InnoDB</strong></td>
                    <td><code>SHOW ENGINE INNODB STATUS\G</code>, <code>information_schema.innodb_trx</code> / <code>innodb_locks</code> / <code>innodb_lock_waits</code>, Performance Schema</td>
                    <td>‚Ä¢ ‚ÄúLATEST DETECTED DEADLOCK‚Äù section<br />‚Ä¢ <code>trx_wait_started</code> age</td>
                    <td><code>SELECT waiting_trx_id, waiting_pid, blocking_pid, waiting_query FROM information_schema.innodb_lock_waits;</code></td>
                </tr>
                <tr>
                    <td><strong>Oracle</strong></td>
                    <td><code>V$LOCK</code>, <code>V$SESSION</code>, <code>DBA_BLOCKERS</code>, <code>DBA_WAITERS</code>, <code>V$ASH</code></td>
                    <td>‚Ä¢ <code>BLOCKING_SESSION_STATUS = 'VALID'</code> count<br />‚Ä¢ Session trees from <code>DBA_BLOCKERS</code></td>
                    <td><code>SELECT s.sid, s.serial#, l.id1 AS resource1, l.id2 AS resource2, s.seconds_in_wait FROM v$session s JOIN v$lock l ON s.sid = l.sid WHERE l.block = 1;</code></td>
                </tr>
            </table>
            </p>
            <blockquote>
                <p><strong>Tip</strong>‚ÄÉSave each snippet in a ‚Äúfirst-aid‚Äù script kit (one per engine) so on-call staff can paste-and-go.</p>
            </blockquote>
            <h4 id="alert-thresholds-that-catch-trouble-early-tune-for-your-sla-">Alert thresholds that catch trouble early (<em>tune for your SLA</em>)</h4>
            <p>
            <table>
                <tr>
                    <td>Symptom</td>
                    <td>OLTP starting point</td>
                    <td>Analytic/ETL starting point</td>
                    <td>How to alert</td>
                </tr>
                <tr>
                    <td><strong>Transaction age</strong></td>
                    <td>30 s</td>
                    <td>5 min</td>
                    <td>gauge, page on P95&gt;threshold for 10 min</td>
                </tr>
                <tr>
                    <td><strong>Lock wait</strong></td>
                    <td>2 s</td>
                    <td>30 s</td>
                    <td>histogram + alert on &gt;N waits &gt; threshold / min</td>
                </tr>
                <tr>
                    <td><strong>Deadlocks</strong></td>
                    <td>1/min</td>
                    <td>5/min</td>
                    <td>count(*) from deadlock view over 5 min window</td>
                </tr>
                <tr>
                    <td><strong>% time spent waiting on locks</strong></td>
                    <td>5 %</td>
                    <td>15 %</td>
                    <td>ratio of lock-wait time to total session time</td>
                </tr>
            </table>
            </p>
            <p>A good rule of thumb: <strong>alert on a trend, not a single incident</strong>‚Äîexcept for deadlocks, which deserve immediate attention because they roll back user work.</p>
            <h4 id="when-an-alert-fires-triage-playbook">When an alert fires‚Äîtriage playbook</h4>
            <p>I. <strong>Grab blocker details</strong> (queries above) and write them to an incident doc.</p>
            <p>II. <strong>Decide: kill vs wait</strong></p>
            <ul>
                <li>OLTP? Kill or nudge the blocker; user impact is measured in seconds.</li>
                <li>Batch/ETL? Often OK to wait unless the blocker exceeds a soft limit (e.g., 10 min).</li>
            </ul>
            <p>III. <strong>Collect forensic artefacts</strong></p>
            <ul>
                <li>PostgreSQL ‚Äî enable <code>log_lock_waits</code>, <code>deadlock_timeout = 500ms</code> temporarily.</li>
                <li>SQL Server ‚Äî run an Extended Events session with <code>xml_deadlock_report</code>.</li>
                <li>MySQL ‚Äî dump <code>SHOW ENGINE INNODB STATUS</code> every 30 s until clear.</li>
                <li>Oracle ‚Äî generate an AWR or ASH report over the incident window.</li>
            </ul>
            <p>IV. <strong>Mitigate</strong></p>
            <ul>
                <li>Shorten transaction scopes (commit early, avoid open cursors).</li>
                <li>Add or refine indexes so readers don‚Äôt escalate to page/extent locks.</li>
                <li>Re-order statements to access tables in a consistent order.</li>
                <li>Consider optimistic isolation (PostgreSQL <code>READ COMMITTED</code> + <code>statement_timeout</code>, SQL Server <code>READ_COMMITTED_SNAPSHOT</code>, Oracle <code>FOR UPDATE SKIP LOCKED</code>).</li>
            </ul>
            <h4 id="automating-the-watch">Automating the watch</h4>
            <p>
            <table>
                <tr>
                    <td>Layer</td>
                    <td>Tooling ideas</td>
                    <td>Notes &amp; nice-to-haves</td>
                </tr>
                <tr>
                    <td><strong>DB native</strong></td>
                    <td>PostgreSQL <code>pg_stat_statements</code>, <code>pgwatch2</code>; SQL Server Agent alerts + Query Store; MySQL Performance Schema; Oracle Enterprise Manager</td>
                    <td>Fire alerts directly from the database when possible‚Äîlatency-free and resilient to network loss.</td>
                </tr>
                <tr>
                    <td><strong>Metrics/time-series</strong></td>
                    <td>Prometheus + Grafana, Datadog DBM, New Relic, AWS CloudWatch RDS metrics</td>
                    <td>Export <code>lock_wait_time</code>, <code>deadlocks_total</code>, <code>xact_age_seconds</code> as counters/gauges. Grafana‚Äôs state-timeline panel is perfect for showing blockers over time.</td>
                </tr>
                <tr>
                    <td><strong>Notification</strong></td>
                    <td>PagerDuty, Opsgenie, Slack/Teams webhook</td>
                    <td>Include the SQL text &amp; locks held so the first responder can act without shell access.</td>
                </tr>
            </table>
            </p>
            <h4 id="continuous-improvement-loop">Continuous improvement loop</h4>
            <ol>
                <li><strong>Review weekly</strong> the ‚Äútop ten longest blockers‚Äù list.</li>
                <li><strong>Refactor</strong> high-contended code paths (break up batch jobs, swap row for key-value store where feasible).</li>
                <li><strong>Tune thresholds</strong> as usage grows‚Äîsuccessful apps outgrow yesterday‚Äôs idea of ‚Äúlong‚Äù.</li>
                <li><strong>Educate developers</strong>: share post-mortems, highlight how small design choices (e.g., ‚Äúalways write parent then child‚Äù) prevent deadlocks entirely.</li>
            </ol>
            <blockquote>
                <p><em>‚ÄúA lock issue once a quarter is a blameless learning opportunity. The same lock issue every week is a monitoring failure.‚Äù</em></p>
            </blockquote>
            <h3 id="real-world-example-ticket-booking-system">Real-World Example: Ticket Booking System</h3>
            <p>Below is a self-contained, ‚Äúcopy-paste-ready‚Äù walk-through you can run on your laptop to <strong>see the double-booking bug happen, then fix it, and finally prove the fix works</strong>.</p>
            <h4 id="stack-prerequisites">Stack &amp; prerequisites</h4>
            <p>
            <table>
                <tr>
                    <td>Layer</td>
                    <td>Why we pick it</td>
                    <td>Other options</td>
                </tr>
                <tr>
                    <td><strong>PostgreSQL ‚â• 10</strong></td>
                    <td>Mature row-level locks (<code>SELECT ‚Ä¶ FOR UPDATE</code>) and full ACID isolation levels.</td>
                    <td>MySQL (InnoDB), SQL Server (<code>WITH (UPDLOCK)</code>), Oracle (<code>SELECT ‚Ä¶ FOR UPDATE</code>), MariaDB, CockroachDB, YugabyteDB</td>
                </tr>
                <tr>
                    <td><strong>Python 3.9+</strong></td>
                    <td>Quick to script concurrent threads; <code>psycopg2-binary</code> client is ubiquitous.</td>
                    <td>Node.js + pg, Java + JDBC, Go + pgx</td>
                </tr>
                <tr>
                    <td><strong>psycopg2-binary</strong></td>
                    <td>PostgreSQL driver.</td>
                    <td>pg-8000, asyncpg</td>
                </tr>
                <tr>
                    <td><strong>Threading</strong> (not asyncio)</td>
                    <td>Easiest to show true race with two parallel transactions in separate connections.</td>
                    <td>multiprocessing, separate psql shells</td>
                </tr>
            </table>
            </p>
            <blockquote>
                <p><strong>Install once</strong></p>
                <div>
                    <pre><code class="language-bash">&gt; pip install psycopg2-binary
&gt; # PostgreSQL: brew install postgresql or apt install postgresql
&gt;</code></pre>
                </div>
            </blockquote>
            <p>The same SQL works, almost verbatim, on the other databases listed above (the locking keywords differ slightly‚Äîsee ¬ß 5).</p>
            <h4 id="build-a-miniature-ticket-system">Build a miniature ticket system</h4>
            <div>
                <pre><code class="language-sql">-- file: setup.sql
DROP TABLE IF EXISTS concerts CASCADE;
CREATE TABLE concerts (
    id          SERIAL PRIMARY KEY,
    title       TEXT NOT NULL,
    tickets_left INTEGER NOT NULL CHECK (tickets_left &gt;= 0)
);

INSERT INTO concerts (title, tickets_left) VALUES ('RockFest 2025', 1);</code></pre>
            </div>
            <div>
                <pre><code class="language-bash">psql -U postgres -f setup.sql</code></pre>
            </div>
            <p>We start with <strong>exactly one ticket</strong> left, which is the classic ‚Äúlast-seat‚Äù problem.</p>
            <h4 id="reproduce-the-double-booking-bug">Reproduce the double-booking bug</h4>
            <p>Create <code>race_demo.py</code>:</p>
            <div>
                <pre><code class="language-python">import psycopg2, threading, time, random

DSN = "dbname=postgres user=postgres host=localhost"

def buy_ticket(name):
    conn = psycopg2.connect(DSN)
    conn.set_session(isolation_level='READ COMMITTED', autocommit=False)
    cur = conn.cursor()

    try:
        cur.execute("BEGIN;")                         # open txn
        cur.execute("SELECT tickets_left FROM concerts WHERE id = 1;")
        tickets = cur.fetchone()[0]
        print(f"{name}: saw {tickets} ticket(s) left")

        if tickets &gt; 0:
            # simulate user thinking
            time.sleep(random.uniform(0.5, 1.5))
            cur.execute("UPDATE concerts SET tickets_left = tickets_left - 1 WHERE id = 1;")
            print(f"{name}: bought the ticket!")
        else:
            print(f"{name}: no tickets left")

        conn.commit()
    except Exception as e:
        print(f"{name}: ERROR {e}")
        conn.rollback()
    finally:
        conn.close()

threads = [threading.Thread(target=buy_ticket, args=(f"User{i}",)) for i in (1, 2)]
for t in threads: t.start()
for t in threads: t.join()

with psycopg2.connect(DSN) as check_conn:
    with check_conn.cursor() as cur:
        cur.execute("SELECT tickets_left FROM concerts WHERE id = 1;")
        print("After race, tickets_left =", cur.fetchone()[0])</code></pre>
            </div>
            <p>Run it twice:</p>
            <div>
                <pre><code class="language-bash">python race_demo.py</code></pre>
            </div>
            <p><strong>Expected output without locks (typical run)</strong></p>
            <div>
                <pre><code class="language-shell">User1: saw 1 ticket(s) left
User2: saw 1 ticket(s) left
User1: bought the ticket!
User2: bought the ticket!
After race, tickets_left = -1        &lt;-- Over-sale!</code></pre>
            </div>
            <p>Both threads decremented the same row because they <strong>read before each other updated</strong>, demonstrating a real-world overbooking.</p>
            <h4 id="prevent-it-pessimistic-locking-">Prevent it (pessimistic locking)</h4>
            <p>Patch the critical section with <code>SELECT ‚Ä¶ FOR UPDATE</code>:</p>
            <div>
                <pre><code class="language-python"># ---------- only the changed part ----------
cur.execute("SELECT tickets_left FROM concerts WHERE id = 1 FOR UPDATE;")</code></pre>
            </div>
            <p>(Full fixed file: <code>race_demo_fixed.py</code> in the repo below.)</p>
            <p>Reset stock then test again:</p>
            <div>
                <pre><code class="language-bash">psql -U postgres -c "UPDATE concerts SET tickets_left = 1 WHERE id = 1;"
python race_demo_fixed.py</code></pre>
            </div>
            <p><strong>Expected output with lock</strong></p>
            <div>
                <pre><code class="language-shell">User1: saw 1 ticket(s) left
User1: bought the ticket!
User2: waiting for row lock...
User2: saw 0 ticket(s) left
User2: no tickets left
After race, tickets_left = 0         &lt;-- Correct</code></pre>
            </div>
            <blockquote>
                <p>In practice you‚Äôd intercept ‚Äúno tickets left‚Äù on the application layer and return an <em>HTTP 409 ‚Äì Sold Out</em>.</p>
            </blockquote>
            <p>Why it works:</p>
            <ul>
                <li><code>FOR UPDATE</code> grabs an <strong>exclusive row-level lock</strong>.</li>
                <li>While User 1 holds it, User 2 blocks until the lock is released.</li>
                <li>Once User 2 enters, the row value is <strong>already updated</strong>, so it sees <code>0</code> and aborts its purchase path.</li>
            </ul>
            <h4 id="at-a-glance-equivalents-in-other-engines">At a glance: equivalents in other engines</h4>
            <p>
            <table>
                <tr>
                    <td>Engine</td>
                    <td>Pessimistic lock syntax</td>
                    <td>Notes</td>
                </tr>
                <tr>
                    <td>PostgreSQL</td>
                    <td><code>SELECT ‚Ä¶ FOR UPDATE</code></td>
                    <td>Recommended. Use <code>FOR NO KEY UPDATE</code> if only updating non-key cols.</td>
                </tr>
                <tr>
                    <td>MySQL (InnoDB)</td>
                    <td><code>SELECT ‚Ä¶ FOR UPDATE</code></td>
                    <td>Works only in a transaction; default isolation <code>REPEATABLE READ</code>.</td>
                </tr>
                <tr>
                    <td>SQL Server</td>
                    <td><code>SELECT ‚Ä¶ WITH (UPDLOCK, ROWLOCK)</code></td>
                    <td>Or table hint in <code>UPDATE ‚Ä¶</code>.</td>
                </tr>
                <tr>
                    <td>Oracle</td>
                    <td><code>SELECT ‚Ä¶ FOR UPDATE</code></td>
                    <td>Same behavior as Postgres.</td>
                </tr>
                <tr>
                    <td>MongoDB</td>
                    <td>Use a <strong>transaction</strong> plus an <code>$inc</code> with <code>$cond</code> or <code>findAndModify</code></td>
                    <td>Replica sets/sharded clusters only.</td>
                </tr>
                <tr>
                    <td>Redis</td>
                    <td><code>EVAL</code> Lua script implementing <code>GET tickets; DECR ticket</code> atomically</td>
                    <td>Single-threaded nature keeps atomicity.</td>
                </tr>
            </table>
            </p>
            <h4 id="alternative-optimistic-locking">Alternative: optimistic locking</h4>
            <p>If you dislike blocking, add a <strong>version column</strong>:</p>
            <div>
                <pre><code class="language-sql">ALTER TABLE concerts ADD COLUMN version INTEGER NOT NULL DEFAULT 0;</code></pre>
            </div>
            <p>Application flow:</p>
            <p>I. <code>SELECT tickets_left, version FROM concerts WHERE id = 1;</code></p>
            <p>II. If tickets_left &gt; 0, run</p>
            <div>
                <pre><code class="language-sql">UPDATE concerts
   SET tickets_left = tickets_left - 1,
       version = version + 1
 WHERE id = 1
   AND version = :previous_version;</code></pre>
            </div>
            <p>III. Check <code>cursor.rowcount</code>:</p>
            <ul>
                <li><code>1</code> ‚Üí success</li>
                <li><code>0</code> ‚Üí someone modified the row first ‚áí retry or inform user.</li>
            </ul>
            <p>Works everywhere a single <code>UPDATE</code> can match on the old version.</p>
            <h4 id="quick-checklist-for-your-project">Quick checklist for your project</h4>
            <p>I. <strong>Pick your strategy</strong></p>
            <ul>
                <li>Low traffic ‚Üí pessimistic lock is simplest.</li>
                <li>High traffic / micro-services ‚Üí optimistic retries scale better.</li>
            </ul>
            <p>II. <strong>Keep the critical section tiny</strong> ‚Äì read, validate, update, commit.</p>
            <p>III. <strong>Always wrap in a transaction</strong>; otherwise <code>FOR UPDATE</code> does nothing.</p>
            <p>IV. Add <strong>monitoring</strong>: alert if <code>tickets_left</code> ever &lt; 0 or if conflicts exceed a threshold.</p>
            <p>V. Unit-test with <strong>concurrency harness</strong> (exactly like <code>race_demo.py</code>) in CI.</p>
        </article-section>
    </div>
    <footer>
        <div class="footer-columns">
            <div class="footer-column footer-about">
                <h2>About</h2>
                <p class="footer-message">Thanks for stopping by. This site is free to use; please be respectful and avoid misuse. For questions or collaboration, reach me on <a href="https://www.linkedin.com/in/adam-djellouli-1bb54619a/" title="LinkedIn Profile">LinkedIn</a> or <a href="https://github.com/djeada" title="GitHub Profile">GitHub</a>.</p>
                <p class="footer-signature">Built with care in Berlin (UTC+1).</p>
            </div>
            <div class="footer-column footer-links">
                <h2>Quick Links</h2>
                <ul class="footer-links-list">
                    <li><a href="https://adamdjellouli.com/index.html" title="Home">Home</a></li>
                    <li><a href="https://adamdjellouli.com/core/projects.html" title="Projects">Projects</a></li>
                    <li><a href="https://adamdjellouli.com/core/tools.html" title="Tools">Tools</a></li>
                    <li><a href="https://adamdjellouli.com/core/courses.html" title="Courses">Courses</a></li>
                    <li><a href="https://adamdjellouli.com/core/resume.html" title="Resume">Resume</a></li>
                    <li><a href="https://adamdjellouli.com/core/privacy_policy.html" title="Privacy Policy">Privacy Policy</a></li>
                    <li><a href="https://adamdjellouli.com/sitemap.xml" title="Sitemap">Sitemap</a></li>
                </ul>
            </div>
            <div class="footer-column footer-social">
                <h2>Follow</h2>
                <ul class="social-media">
                    <li>
                        <a aria-label="YouTube" class="fa fa-youtube" href="https://www.youtube.com/channel/UCGPoHTVjMN77wcGknXPHl1Q" rel="noopener" target="_blank" title="YouTube"></a>
                        <span class="social-label">YouTube</span>
                    </li>
                    <li>
                        <a aria-label="LinkedIn" class="fa fa-linkedin" href="https://www.linkedin.com/in/adam-djellouli-1bb54619a/" rel="noopener" target="_blank" title="LinkedIn"></a>
                        <span class="social-label">LinkedIn</span>
                    </li>
                    <li>
                        <a aria-label="Instagram" class="fa fa-instagram" href="https://www.instagram.com/linuxchallenges/" rel="noopener" target="_blank" title="Instagram"></a>
                        <span class="social-label">Instagram</span>
                    </li>
                    <li>
                        <a aria-label="GitHub" class="fa fa-github" href="https://github.com/djeada" title="GitHub"></a>
                        <span class="social-label">GitHub</span>
                    </li>
                </ul>
                <img alt="" aria-hidden="true" class="footer-mark" src="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/symbol.png" />
            </div>
        </div>
        <div class="footer-bottom">
            <p id="copyright">
                ¬© Adam Djellouli. All rights reserved.
            </p>
        </div>
        <script>
            document.getElementById("copyright").innerHTML = "&copy; " + new Date().getFullYear() + " Adam Djellouli. All rights reserved.";
        </script>
        <script src="/app.js"></script>
    </footer>
    <div id="pdf-spinner-overlay">
        <div class="spinner"></div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-cpp.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
jax: ["input/TeX", "output/HTML-CSS"],
extensions: ["tex2jax.js"],
"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] },
tex2jax: { inlineMath: [ ["$", "$"] ], displayMath: [ ["$$","$$"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
TeX: { noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } } },
messageStyle: "none"
});
</script>
<script async="" id="MathJax-script" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>

</html>