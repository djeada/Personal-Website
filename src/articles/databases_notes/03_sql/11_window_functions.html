<!DOCTYPE html>

<html lang="en">

<head>
    <script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5593122079896089"></script>
    <meta charset="utf-8" />
    <title>Window Functions in SQL</title>
    <meta content="Window functions in SQL are powerful tools that allow you to perform calculations across a set of table rows that are related to the current row." name="description" />
    <meta content="Adam Djellouli" name="author" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <link crossorigin="" href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/themes/prism.min.css" rel="stylesheet" />
    <link href="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/icon.ico" rel="icon" />
    <link href="../../../resources/style.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>
    <nav aria-label="Main navigation">
        <a class="logo" href="https://adamdjellouli.com">
            <img alt="Adam Djellouli - Home Page Logo" id="logo-image" src="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/logo.PNG" />
        </a>
        <input aria-label="Toggle navigation menu" id="navbar-toggle" type="checkbox" />
        <ul aria-labelledby="navbar-toggle" role="menu">
            <li role="menuitem">
                <a href="../../../index.html" title="Go to Home Page"> Home </a>
            </li>
            <li role="menuitem">
                <a class="active" href="../../../core/blog.html" title="Read Adam Djellouli Blog on Programming and Technology"> Blog </a>
            </li>
            <li role="menuitem">
                <a href="../../../core/tools.html" title="Discover Tools Created by Adam Djellouli"> Tools </a>
            </li>
            <li role="menuitem">
                <a href="../../../core/projects.html" title="Explore Projects Developed by Adam Djellouli"> Projects </a>
            </li>
            <li role="menuitem">
                <a href="../../../core/resume.html" title="View Adam Djellouli Professional Resume"> Resume </a>
            </li>
            <li>
                <script async="" src="https://cse.google.com/cse.js?cx=8160ef9bb935f4f68"></script>
                <div class="gcse-search"></div>
            </li>
            <li>
                <button aria-label="Toggle dark mode" id="dark-mode-button"></button>
            </li>
        </ul>
    </nav>
    <div id="article-wrapper">
        <section id="article-body">
            <div class="article-action-buttons"><button class="btn-suggest-edit" title="Suggest Edit">
                    <svg fill="none" height="20" viewbox="0 0 24 24" width="20">
                        <path d="M4 21h4l11-11-4-4L4 17v4z" stroke="currentColor" stroke-width="2"></path>
                    </svg>
                </button><button class="btn-create-issue" title="Create Issue">
                    <svg fill="none" height="20" viewbox="0 0 24 24" width="20">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"></circle>
                        <line stroke="currentColor" stroke-width="2" x1="12" x2="12" y1="8" y2="12"></line>
                        <circle cx="12" cy="16" fill="currentColor" r="1"></circle>
                    </svg>
                </button><button class="btn-download" title="Download">
                    <svg fill="none" height="20" viewbox="0 0 24 24" width="20">
                        <path d="M12 5v14m0 0l-6-6m6 6l6-6" stroke="currentColor" stroke-width="2"></path>
                    </svg>
                </button></div>
            <p style="text-align: right;"><i>Last modified: August 19, 2020</i></p>
            <p style="text-align: right;"><i>This article is written in: ðŸ‡ºðŸ‡¸</i></p>
            <h2 id="window-functions-in-sql">Window Functions in SQL</h2>
            <p>Window functions in SQL are powerful tools that allow you to perform calculations across a set of table rows that are related to the current row. Unlike aggregate functions, window functions do not collapse rows into a single output row; instead, they retain the individual row identities while providing additional analytical capabilities. Window functions are essential for advanced data analysis, reporting, and generating insights that require comparisons or calculations across related rows.</p>
            <p>After reading the material, you should be able to answer the following questions:</p>
            <ol>
                <li>What are window functions in SQL, and how do they differ from aggregate functions?</li>
                <li>What are some common window functions, and what are their typical use cases?</li>
                <li>How does the <code>OVER</code> clause define the window for window functions, and what components can it include?</li>
                <li>What are the advantages and limitations of using window functions compared to traditional methods like self-joins?</li>
                <li>What best practices should be followed when implementing window functions in SQL to ensure optimal performance and maintainability?</li>
            </ol>
            <h3 id="common-window-functions">Common Window Functions</h3>
            <p>Here are some of the most commonly used window functions in SQL:</p>
            <ul>
                <li><strong><code>ROW_NUMBER()</code></strong>: Assigns a unique sequential integer to rows within a partition of a result set, starting at 1 for the first row in each partition.</li>
                <li><strong><code>RANK()</code></strong>: Assigns a rank to each row within a partition of a result set, with gaps in ranking values when there are ties.</li>
                <li><strong><code>DENSE_RANK()</code></strong>: Similar to <code>RANK()</code>, but without gaps in ranking values when there are ties.</li>
                <li><strong><code>NTILE()</code></strong>: Distributes rows into a specified number of approximately equal groups.</li>
                <li><strong><code>LEAD()</code></strong>: Provides access to a subsequent rowâ€™s data without the need for a self-join.</li>
                <li><strong><code>LAG()</code></strong>: Provides access to a preceding rowâ€™s data without the need for a self-join.</li>
                <li><strong>Aggregate Window Functions</strong>: Such as <code>SUM()</code>, <code>AVG()</code>, <code>COUNT()</code>, which perform aggregate calculations over a window.</li>
            </ul>
            <h3 id="setting-up-example-tables">Setting Up Example Tables</h3>
            <p>Suppose we have two tables: <code>Sales</code> and <code>Products</code>.</p>
            <p><strong>Sales Table</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>2024-01-05</td>
                    <td>10</td>
                    <td>15.00</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>102</td>
                    <td>2024-01-07</td>
                    <td>5</td>
                    <td>25.00</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>103</td>
                    <td>2024-01-12</td>
                    <td>7</td>
                    <td>30.00</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>102</td>
                    <td>2024-01-15</td>
                    <td>10</td>
                    <td>25.00</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>103</td>
                    <td>2024-01-22</td>
                    <td>5</td>
                    <td>30.00</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>104</td>
                    <td>2024-01-25</td>
                    <td>12</td>
                    <td>20.00</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>102</td>
                    <td>2024-01-28</td>
                    <td>8</td>
                    <td>25.00</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>104</td>
                    <td>2024-01-30</td>
                    <td>10</td>
                    <td>20.00</td>
                </tr>
            </table>
            </p>
            <p><strong>Products Table</strong></p>
            <p>
            <table>
                <tr>
                    <td>ProductID</td>
                    <td>ProductName</td>
                    <td>Category</td>
                </tr>
                <tr>
                    <td>101</td>
                    <td>Widget A</td>
                    <td>Gadgets</td>
                </tr>
                <tr>
                    <td>102</td>
                    <td>Widget B</td>
                    <td>Gadgets</td>
                </tr>
                <tr>
                    <td>103</td>
                    <td>Gizmo C</td>
                    <td>Widgets</td>
                </tr>
                <tr>
                    <td>104</td>
                    <td>Gizmo D</td>
                    <td>Widgets</td>
                </tr>
            </table>
            </p>
            <h3 id="understanding-the-over-clause">Understanding the <code>OVER</code> Clause</h3>
            <p>Window functions use the <code>OVER</code> clause to define the window or the set of rows the function should operate on. The <code>OVER</code> clause can include:</p>
            <ul>
                <li><strong><code>PARTITION BY</code></strong>: Divides the result set into partitions to which the window function is applied.</li>
                <li><strong><code>ORDER BY</code></strong>: Defines the logical order of rows within each partition.</li>
                <li><strong>Window Frame Specification</strong>: Specifies the subset of rows within the partition for frame-based calculations (e.g., <code>ROWS BETWEEN</code>).</li>
            </ul>
            <h3 id="row_number-function">ROW_NUMBER Function</h3>
            <p>The <code>ROW_NUMBER()</code> function assigns a unique sequential integer to rows within a partition, starting at 1 for the first row in each partition.</p>
            <h4 id="example-assigning-row-numbers-to-sales-per-product">Example: Assigning Row Numbers to Sales per Product</h4>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    ROW_NUMBER() OVER (PARTITION BY ProductID ORDER BY SaleDate) AS RowNum
FROM
    Sales
ORDER BY
    ProductID,
    SaleDate;</code></pre>
            </div>
            </p>
            <p><strong>Result</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                    <td>RowNum</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>2024-01-05</td>
                    <td>10</td>
                    <td>15.00</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>102</td>
                    <td>2024-01-07</td>
                    <td>5</td>
                    <td>25.00</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>102</td>
                    <td>2024-01-15</td>
                    <td>10</td>
                    <td>25.00</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>102</td>
                    <td>2024-01-28</td>
                    <td>8</td>
                    <td>25.00</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>103</td>
                    <td>2024-01-12</td>
                    <td>7</td>
                    <td>30.00</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>103</td>
                    <td>2024-01-22</td>
                    <td>5</td>
                    <td>30.00</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>104</td>
                    <td>2024-01-25</td>
                    <td>12</td>
                    <td>20.00</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>104</td>
                    <td>2024-01-30</td>
                    <td>10</td>
                    <td>20.00</td>
                    <td>2</td>
                </tr>
            </table>
            </p>
            <ul>
                <li>The <code>ROW_NUMBER()</code> function assigns a unique row number to each sale within its <code>ProductID</code> partition based on the <code>SaleDate</code>.</li>
                <li>Useful for tasks like pagination or identifying specific rows within partitions.</li>
            </ul>
            <h3 id="rank-and-dense_rank-functions">RANK and DENSE_RANK Functions</h3>
            <p>Both <code>RANK()</code> and <code>DENSE_RANK()</code> assign a rank to each row within a partition. The difference lies in how they handle ties.</p>
            <ul>
                <li><strong><code>RANK()</code></strong>: Assigns the same rank to tied rows but leaves gaps in the ranking sequence.</li>
                <li><strong><code>DENSE_RANK()</code></strong>: Assigns the same rank to tied rows without leaving gaps.</li>
            </ul>
            <h4 id="example-ranking-sales-by-quantity-per-product">Example: Ranking Sales by Quantity per Product</h4>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    RANK() OVER (PARTITION BY ProductID ORDER BY Quantity DESC) AS Rank,
    DENSE_RANK() OVER (PARTITION BY ProductID ORDER BY Quantity DESC) AS DenseRank
FROM
    Sales
ORDER BY
    ProductID,
    Quantity DESC;</code></pre>
            </div>
            </p>
            <p><strong>Result</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                    <td>Rank</td>
                    <td>DenseRank</td>
                </tr>
                <tr>
                    <td>101</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                    <td>1</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                    <td>2</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>2024-01-05</td>
                    <td>10</td>
                    <td>15.00</td>
                    <td>3</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>102</td>
                    <td>102</td>
                    <td>2024-01-15</td>
                    <td>10</td>
                    <td>25.00</td>
                    <td>1</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>102</td>
                    <td>2024-01-28</td>
                    <td>8</td>
                    <td>25.00</td>
                    <td>2</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>102</td>
                    <td>2024-01-07</td>
                    <td>5</td>
                    <td>25.00</td>
                    <td>3</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>103</td>
                    <td>103</td>
                    <td>2024-01-12</td>
                    <td>7</td>
                    <td>30.00</td>
                    <td>1</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>103</td>
                    <td>2024-01-22</td>
                    <td>5</td>
                    <td>30.00</td>
                    <td>2</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>104</td>
                    <td>104</td>
                    <td>2024-01-25</td>
                    <td>12</td>
                    <td>20.00</td>
                    <td>1</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>104</td>
                    <td>2024-01-30</td>
                    <td>10</td>
                    <td>20.00</td>
                    <td>2</td>
                    <td>2</td>
                </tr>
            </table>
            </p>
            <ul>
                <li><strong><code>RANK()</code></strong> and <strong><code>DENSE_RANK()</code></strong> are useful for identifying the position of rows within partitions, especially when dealing with ties.</li>
            </ul>
            <h3 id="ntile-function">NTILE Function</h3>
            <p>The <code>NTILE()</code> function distributes the rows in an ordered partition into a specified number of roughly equal groups.</p>
            <h4 id="example-dividing-sales-into-quartiles-per-product">Example: Dividing Sales into Quartiles per Product</h4>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    NTILE(4) OVER (PARTITION BY ProductID ORDER BY Quantity DESC) AS Quartile
FROM
    Sales
ORDER BY
    ProductID,
    Quantity DESC;</code></pre>
            </div>
            </p>
            <p><strong>Result</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                    <td>Quartile</td>
                </tr>
                <tr>
                    <td>101</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>2024-01-05</td>
                    <td>10</td>
                    <td>15.00</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>102</td>
                    <td>102</td>
                    <td>2024-01-15</td>
                    <td>10</td>
                    <td>25.00</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>102</td>
                    <td>2024-01-28</td>
                    <td>8</td>
                    <td>25.00</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>102</td>
                    <td>2024-01-07</td>
                    <td>5</td>
                    <td>25.00</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>103</td>
                    <td>103</td>
                    <td>2024-01-12</td>
                    <td>7</td>
                    <td>30.00</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>103</td>
                    <td>2024-01-22</td>
                    <td>5</td>
                    <td>30.00</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>104</td>
                    <td>104</td>
                    <td>2024-01-25</td>
                    <td>12</td>
                    <td>20.00</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>104</td>
                    <td>2024-01-30</td>
                    <td>10</td>
                    <td>20.00</td>
                    <td>2</td>
                </tr>
            </table>
            </p>
            <ul>
                <li>The <code>NTILE(4)</code> function divides each <code>ProductID</code> partition into four quartiles based on <code>Quantity</code>.</li>
                <li>Useful for categorizing data into percentile-based groups.</li>
            </ul>
            <h3 id="lead-and-lag-functions">LEAD and LAG Functions</h3>
            <p><code>LEAD()</code> and <code>LAG()</code> functions allow you to access subsequent and preceding rows' data without the need for self-joins.</p>
            <h4 id="example-comparing-current-sale-with-previous-sale-quantity-per-product">Example: Comparing Current Sale with Previous Sale Quantity per Product</h4>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    LAG(Quantity, 1) OVER (PARTITION BY ProductID ORDER BY SaleDate) AS PreviousQuantity,
    Quantity - LAG(Quantity, 1) OVER (PARTITION BY ProductID ORDER BY SaleDate) AS QuantityChange
FROM
    Sales
ORDER BY
    ProductID,
    SaleDate;</code></pre>
            </div>
            </p>
            <p><strong>Result</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                    <td>PreviousQuantity</td>
                    <td>QuantityChange</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>2024-01-05</td>
                    <td>10</td>
                    <td>15.00</td>
                    <td>NULL</td>
                    <td>NULL</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                    <td>10</td>
                    <td>10</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                    <td>20</td>
                    <td>-5</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>102</td>
                    <td>2024-01-07</td>
                    <td>5</td>
                    <td>25.00</td>
                    <td>NULL</td>
                    <td>NULL</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>102</td>
                    <td>2024-01-15</td>
                    <td>10</td>
                    <td>25.00</td>
                    <td>5</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>102</td>
                    <td>2024-01-28</td>
                    <td>8</td>
                    <td>25.00</td>
                    <td>10</td>
                    <td>-2</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>103</td>
                    <td>2024-01-12</td>
                    <td>7</td>
                    <td>30.00</td>
                    <td>NULL</td>
                    <td>NULL</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>103</td>
                    <td>2024-01-22</td>
                    <td>5</td>
                    <td>30.00</td>
                    <td>7</td>
                    <td>-2</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>104</td>
                    <td>2024-01-25</td>
                    <td>12</td>
                    <td>20.00</td>
                    <td>NULL</td>
                    <td>NULL</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>104</td>
                    <td>2024-01-30</td>
                    <td>10</td>
                    <td>20.00</td>
                    <td>12</td>
                    <td>-2</td>
                </tr>
            </table>
            </p>
            <ul>
                <li><strong><code>LAG(Quantity, 1)</code></strong> retrieves the quantity from the previous sale within the same <code>ProductID</code> partition.</li>
                <li><strong><code>LEAD()</code></strong> can similarly retrieve data from subsequent rows.</li>
                <li>Useful for trend analysis and calculating differences between consecutive rows.</li>
            </ul>
            <h3 id="aggregate-window-functions">Aggregate Window Functions</h3>
            <p>Aggregate functions like <code>SUM()</code>, <code>AVG()</code>, and <code>COUNT()</code> can also be used as window functions to perform calculations across a window of rows.</p>
            <h4 id="example-calculating-running-total-of-sales-amount-per-product">Example: Calculating Running Total of Sales Amount per Product</h4>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    Quantity * Price AS SaleAmount,
    SUM(Quantity * Price) OVER (PARTITION BY ProductID ORDER BY SaleDate ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS RunningTotal
FROM
    Sales
ORDER BY
    ProductID,
    SaleDate;</code></pre>
            </div>
            </p>
            <p><strong>Result</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                    <td>SaleAmount</td>
                    <td>RunningTotal</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>2024-01-05</td>
                    <td>10</td>
                    <td>15.00</td>
                    <td>150.00</td>
                    <td>150.00</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                    <td>300.00</td>
                    <td>450.00</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                    <td>225.00</td>
                    <td>675.00</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>102</td>
                    <td>2024-01-07</td>
                    <td>5</td>
                    <td>25.00</td>
                    <td>125.00</td>
                    <td>125.00</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>102</td>
                    <td>2024-01-15</td>
                    <td>10</td>
                    <td>25.00</td>
                    <td>250.00</td>
                    <td>375.00</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>102</td>
                    <td>2024-01-28</td>
                    <td>8</td>
                    <td>25.00</td>
                    <td>200.00</td>
                    <td>575.00</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>103</td>
                    <td>2024-01-12</td>
                    <td>7</td>
                    <td>30.00</td>
                    <td>210.00</td>
                    <td>210.00</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>103</td>
                    <td>2024-01-22</td>
                    <td>5</td>
                    <td>30.00</td>
                    <td>150.00</td>
                    <td>360.00</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>104</td>
                    <td>2024-01-25</td>
                    <td>12</td>
                    <td>20.00</td>
                    <td>240.00</td>
                    <td>240.00</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>104</td>
                    <td>2024-01-30</td>
                    <td>10</td>
                    <td>20.00</td>
                    <td>200.00</td>
                    <td>440.00</td>
                </tr>
            </table>
            </p>
            <ul>
                <li><strong><code>SUM(Quantity * Price) OVER (...)</code></strong> calculates a running total of sales amounts within each <code>ProductID</code> partition ordered by <code>SaleDate</code>.</li>
                <li>The window frame <code>ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code> defines the range from the first row to the current row for cumulative calculations.</li>
            </ul>
            <h3 id="handling-null-values-in-window-functions">Handling NULL Values in Window Functions</h3>
            <p>Window functions typically handle <code>NULL</code> values based on the specific function's behavior. For example, <code>SUM()</code> ignores <code>NULL</code> values, while <code>ROW_NUMBER()</code> assigns a unique number regardless of <code>NULL</code>s.</p>
            <h4 id="example-assigning-row-numbers-with-null-quantities">Example: Assigning Row Numbers with NULL Quantities</h4>
            <p>Suppose we have an additional sale with a <code>NULL</code> quantity.</p>
            <p><strong>Updated Sales Table</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                </tr>
                <tr>
                    <td>11</td>
                    <td>101</td>
                    <td>2024-01-25</td>
                    <td>NULL</td>
                    <td>15.00</td>
                </tr>
            </table>
            </p>
            <p><strong>Query: Assigning Row Numbers Including NULL Quantities</strong></p>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    ROW_NUMBER() OVER (PARTITION BY ProductID ORDER BY SaleDate) AS RowNum
FROM
    Sales
ORDER BY
    ProductID,
    SaleDate;</code></pre>
            </div>
            </p>
            <p><strong>Result</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                    <td>RowNum</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>2024-01-05</td>
                    <td>10</td>
                    <td>15.00</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>11</td>
                    <td>101</td>
                    <td>2024-01-25</td>
                    <td>NULL</td>
                    <td>15.00</td>
                    <td>4</td>
                </tr>
                <tr>
                    <td>...</td>
                    <td>...</td>
                    <td>...</td>
                    <td>...</td>
                    <td>...</td>
                    <td>...</td>
                </tr>
            </table>
            </p>
            <ul>
                <li>The <code>ROW_NUMBER()</code> function assigns a row number to the sale with <code>NULL</code> quantity without any issues.</li>
                <li>Other window functions may handle <code>NULL</code> values differently, depending on their logic.</li>
            </ul>
            <h3 id="practical-tips-for-using-window-functions">Practical Tips for Using Window Functions</h3>
            <ul>
                <li><strong>Use Meaningful Aliases</strong>: Assign descriptive aliases to window function results to improve query readability.</li>
            </ul>
            <p>
            <div>
                <pre><code class="language-sql">ROW_NUMBER() OVER (...) AS RowNumber</code></pre>
            </div>
            </p>
            <ul>
                <li><strong>Combine with <code>PARTITION BY</code> and <code>ORDER BY</code></strong>: Leverage <code>PARTITION BY</code> to segment data and <code>ORDER BY</code> to define the sequence within each partition.</li>
            </ul>
            <p>
            <div>
                <pre><code class="language-sql">RANK() OVER (PARTITION BY Category ORDER BY SaleAmount DESC) AS SaleRank</code></pre>
            </div>
            </p>
            <ul>
                <li><strong>Leverage Window Frames for Advanced Calculations</strong>: Use window frame specifications like <code>ROWS BETWEEN</code> to define dynamic ranges for calculations.</li>
            </ul>
            <p>
            <div>
                <pre><code class="language-sql">AVG(Quantity) OVER (PARTITION BY ProductID ORDER BY SaleDate ROWS BETWEEN 3 PRECEDING AND CURRENT ROW) AS MovingAverage</code></pre>
            </div>
            </p>
            <ul>
                <li>
                    <p><strong>Avoid Overusing Window Functions</strong>: While powerful, excessive use of window functions can lead to complex and less performant queries. Use them judiciously.</p>
                </li>
                <li>
                    <p><strong>Understand Performance Implications</strong>: Window functions can impact query performance, especially on large datasets. Ensure proper indexing and consider query optimization techniques.</p>
                </li>
                <li>
                    <p><strong>Combine with Other SQL Features</strong>: Window functions can be combined with CTEs (Common Table Expressions), subqueries, and other SQL features for more complex analyses.</p>
                </li>
            </ul>
            <p>
            <div>
                <pre><code class="language-sql">WITH RankedSales AS (
      SELECT
          SaleID,
          ProductID,
          SaleDate,
          Quantity,
          Price,
          RANK() OVER (PARTITION BY ProductID ORDER BY Quantity DESC) AS SaleRank
      FROM
          Sales
  )
  SELECT
      rs.SaleID,
      rs.ProductID,
      rs.SaleDate,
      rs.Quantity,
      rs.Price
  FROM
      RankedSales rs
  WHERE
      rs.SaleRank = 1;</code></pre>
            </div>
            </p>
            <h3 id="window-functions-vs-aggregate-functions">Window Functions vs. Aggregate Functions</h3>
            <p>While both window functions and aggregate functions perform calculations over sets of rows, they differ in key ways:</p>
            <ul>
                <li><strong>Row Retention</strong>: </li>
                <li><strong>Aggregate Functions</strong>: Collapse multiple rows into a single summary row per group.</li>
                <li>
                    <p><strong>Window Functions</strong>: Retain individual row identities while providing additional calculated data.</p>
                </li>
                <li>
                    <p><strong>Usage with <code>GROUP BY</code></strong>:</p>
                </li>
                <li><strong>Aggregate Functions</strong>: Require <code>GROUP BY</code> to define grouping.</li>
                <li><strong>Window Functions</strong>: Use the <code>OVER</code> clause to define partitions and ordering without collapsing rows.</li>
            </ul>
            <h4 id="example-comparing-aggregate-and-window-functions">Example: Comparing Aggregate and Window Functions</h4>
            <p><strong>Aggregate Function Example: Total Sales per Product</strong></p>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    ProductID,
    SUM(Quantity * Price) AS TotalSales
FROM
    Sales
GROUP BY
    ProductID;</code></pre>
            </div>
            </p>
            <p><strong>Window Function Example: Total Sales per Product Alongside Each Sale</strong></p>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    SUM(Quantity * Price) OVER (PARTITION BY ProductID) AS TotalSalesPerProduct
FROM
    Sales
ORDER BY
    ProductID,
    SaleDate;</code></pre>
            </div>
            </p>
            <ul>
                <li>The <strong>aggregate function</strong> provides a summarized view with one row per <code>ProductID</code>.</li>
                <li>The <strong>window function</strong> adds the total sales per product to each individual sale row without reducing the number of rows.</li>
            </ul>
            <h3 id="combining-multiple-window-functions">Combining Multiple Window Functions</h3>
            <p>You can use multiple window functions within a single query to perform various analyses simultaneously.</p>
            <h4 id="example-sales-analysis-with-multiple-window-functions">Example: Sales Analysis with Multiple Window Functions</h4>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    ROW_NUMBER() OVER (PARTITION BY ProductID ORDER BY SaleDate) AS RowNum,
    RANK() OVER (PARTITION BY ProductID ORDER BY Quantity DESC) AS QuantityRank,
    SUM(Quantity * Price) OVER (PARTITION BY ProductID ORDER BY SaleDate ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS RunningTotal
FROM
    Sales
ORDER BY
    ProductID,
    SaleDate;</code></pre>
            </div>
            </p>
            <p><strong>Result</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                    <td>RowNum</td>
                    <td>QuantityRank</td>
                    <td>RunningTotal</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>2024-01-05</td>
                    <td>10</td>
                    <td>15.00</td>
                    <td>1</td>
                    <td>2</td>
                    <td>150.00</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                    <td>2</td>
                    <td>1</td>
                    <td>450.00</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                    <td>3</td>
                    <td>3</td>
                    <td>675.00</td>
                </tr>
                <tr>
                    <td>11</td>
                    <td>101</td>
                    <td>2024-01-25</td>
                    <td>NULL</td>
                    <td>15.00</td>
                    <td>4</td>
                    <td>4</td>
                    <td>675.00</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>102</td>
                    <td>2024-01-07</td>
                    <td>5</td>
                    <td>25.00</td>
                    <td>1</td>
                    <td>3</td>
                    <td>125.00</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>102</td>
                    <td>2024-01-15</td>
                    <td>10</td>
                    <td>25.00</td>
                    <td>2</td>
                    <td>1</td>
                    <td>375.00</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>102</td>
                    <td>2024-01-28</td>
                    <td>8</td>
                    <td>25.00</td>
                    <td>3</td>
                    <td>2</td>
                    <td>575.00</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>103</td>
                    <td>2024-01-12</td>
                    <td>7</td>
                    <td>30.00</td>
                    <td>1</td>
                    <td>1</td>
                    <td>210.00</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>103</td>
                    <td>2024-01-22</td>
                    <td>5</td>
                    <td>30.00</td>
                    <td>2</td>
                    <td>2</td>
                    <td>360.00</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>104</td>
                    <td>2024-01-25</td>
                    <td>12</td>
                    <td>20.00</td>
                    <td>1</td>
                    <td>1</td>
                    <td>240.00</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>104</td>
                    <td>2024-01-30</td>
                    <td>10</td>
                    <td>20.00</td>
                    <td>2</td>
                    <td>2</td>
                    <td>440.00</td>
                </tr>
            </table>
            </p>
            <ul>
                <li><strong><code>ROW_NUMBER()</code></strong> assigns a unique row number within each <code>ProductID</code> partition.</li>
                <li><strong><code>RANK()</code></strong> assigns ranks based on <code>Quantity</code> within each <code>ProductID</code>.</li>
                <li><strong><code>SUM() OVER (...)</code></strong> calculates a running total of sales amounts per <code>ProductID</code>.</li>
            </ul>
            <h3 id="window-frames">Window Frames</h3>
            <p>Window frames define the subset of rows within the partition to be used for calculations in window functions. They are specified using the <code>ROWS BETWEEN</code> or <code>RANGE BETWEEN</code> clauses.</p>
            <h4 id="example-calculating-a-moving-average-of-quantity">Example: Calculating a Moving Average of Quantity</h4>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    AVG(Quantity) OVER (
        PARTITION BY ProductID
        ORDER BY SaleDate
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ) AS MovingAverage
FROM
    Sales
ORDER BY
    ProductID,
    SaleDate;</code></pre>
            </div>
            </p>
            <p><strong>Result</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                    <td>MovingAverage</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>2024-01-05</td>
                    <td>10</td>
                    <td>15.00</td>
                    <td>10.00</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                    <td>15.00</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                    <td>15.00</td>
                </tr>
                <tr>
                    <td>11</td>
                    <td>101</td>
                    <td>2024-01-25</td>
                    <td>NULL</td>
                    <td>15.00</td>
                    <td>12.50</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>102</td>
                    <td>2024-01-07</td>
                    <td>5</td>
                    <td>25.00</td>
                    <td>5.00</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>102</td>
                    <td>2024-01-15</td>
                    <td>10</td>
                    <td>25.00</td>
                    <td>7.50</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>102</td>
                    <td>2024-01-28</td>
                    <td>8</td>
                    <td>25.00</td>
                    <td>7.67</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>103</td>
                    <td>2024-01-12</td>
                    <td>7</td>
                    <td>30.00</td>
                    <td>7.00</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>103</td>
                    <td>2024-01-22</td>
                    <td>5</td>
                    <td>30.00</td>
                    <td>6.00</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>104</td>
                    <td>2024-01-25</td>
                    <td>12</td>
                    <td>20.00</td>
                    <td>12.00</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>104</td>
                    <td>2024-01-30</td>
                    <td>10</td>
                    <td>20.00</td>
                    <td>11.00</td>
                </tr>
            </table>
            </p>
            <ul>
                <li>The <code>AVG(Quantity)</code> function calculates the average quantity over the current row and the two preceding rows within each <code>ProductID</code> partition.</li>
                <li>Useful for trend analysis and smoothing out short-term fluctuations.</li>
            </ul>
            <h3 id="practical-use-cases-for-window-functions">Practical Use Cases for Window Functions</h3>
            <ul>
                <li><strong>Pagination</strong>: Assign row numbers to implement pagination in queries.</li>
                <li><strong>Running Totals and Moving Averages</strong>: Calculate cumulative sums or averages over a specified window.</li>
                <li><strong>Ranking and Top-N Analysis</strong>: Determine the top performers or items within categories.</li>
                <li><strong>Comparative Analysis</strong>: Compare current row values with previous or next rows without self-joins.</li>
                <li><strong>Data Transformation</strong>: Restructure data for reporting and analytics purposes.</li>
            </ul>
            <h3 id="combining-window-functions-with-other-sql-features">Combining Window Functions with Other SQL Features</h3>
            <p>Window functions can be combined with Common Table Expressions (CTEs), subqueries, and other SQL constructs to perform complex data transformations and analyses.</p>
            <h4 id="example-identifying-top-2-sales-per-product">Example: Identifying Top 2 Sales per Product</h4>
            <p>
            <div>
                <pre><code class="language-sql">WITH RankedSales AS (
    SELECT
        SaleID,
        ProductID,
        SaleDate,
        Quantity,
        Price,
        RANK() OVER (PARTITION BY ProductID ORDER BY Quantity DESC) AS SaleRank
    FROM
        Sales
)
SELECT
    rs.SaleID,
    rs.ProductID,
    rs.SaleDate,
    rs.Quantity,
    rs.Price
FROM
    RankedSales rs
WHERE
    rs.SaleRank &lt;= 2
ORDER BY
    rs.ProductID,
    rs.SaleRank;</code></pre>
            </div>
            </p>
            <p><strong>Result</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>102</td>
                    <td>2024-01-15</td>
                    <td>10</td>
                    <td>25.00</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>102</td>
                    <td>2024-01-28</td>
                    <td>8</td>
                    <td>25.00</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>103</td>
                    <td>2024-01-12</td>
                    <td>7</td>
                    <td>30.00</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>103</td>
                    <td>2024-01-22</td>
                    <td>5</td>
                    <td>30.00</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>104</td>
                    <td>2024-01-25</td>
                    <td>12</td>
                    <td>20.00</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>104</td>
                    <td>2024-01-30</td>
                    <td>10</td>
                    <td>20.00</td>
                </tr>
            </table>
            </p>
            <ul>
                <li>The CTE <code>RankedSales</code> assigns a rank to each sale based on <code>Quantity</code> within each <code>ProductID</code>.</li>
                <li>The outer query filters to include only the top 2 sales per product.</li>
            </ul>
            <h3 id="comparing-window-functions-with-self-joins">Comparing Window Functions with Self-Joins</h3>
            <p>Before window functions were widely supported, similar analyses often required complex self-joins. Window functions simplify these operations, making queries more readable and efficient.</p>
            <h4 id="example-using-window-functions-vs-self-joins-to-compare-current-and-previous-sales">Example: Using Window Functions vs. Self-Joins to Compare Current and Previous Sales</h4>
            <p><strong>Using Window Functions</strong></p>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    LAG(Quantity) OVER (PARTITION BY ProductID ORDER BY SaleDate) AS PreviousQuantity
FROM
    Sales
ORDER BY
    ProductID,
    SaleDate;</code></pre>
            </div>
            </p>
            <p><strong>Using Self-Joins</strong></p>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    s1.SaleID,
    s1.ProductID,
    s1.SaleDate,
    s1.Quantity,
    s1.Price,
    s2.Quantity AS PreviousQuantity
FROM
    Sales s1
LEFT JOIN
    Sales s2
    ON s1.ProductID = s2.ProductID
    AND s1.SaleDate &gt; s2.SaleDate
    AND NOT EXISTS (
        SELECT 1
        FROM Sales s3
        WHERE s3.ProductID = s1.ProductID
        AND s3.SaleDate &gt; s2.SaleDate
        AND s3.SaleDate &lt; s1.SaleDate
    )
ORDER BY
    s1.ProductID,
    s1.SaleDate;</code></pre>
            </div>
            </p>
            <ul>
                <li>The <strong>window function</strong> approach is more straightforward, readable, and performs better.</li>
                <li>The <strong>self-join</strong> approach is more complex and can be less efficient, especially on large datasets.</li>
            </ul>
            <h3 id="limitations-and-considerations">Limitations and Considerations</h3>
            <ul>
                <li><strong>Performance</strong>: Window functions can be resource-intensive on large datasets. Proper indexing and query optimization are crucial.</li>
                <li><strong>Compatibility</strong>: Ensure that your SQL database system supports the window functions you intend to use (e.g., PostgreSQL, SQL Server, Oracle, MySQL 8.0+).</li>
                <li><strong>Complexity</strong>: While window functions simplify many operations, overusing them or using them in overly complex ways can make queries harder to maintain.</li>
                <li><strong>Understanding Window Frames</strong>: Properly defining window frames is essential for accurate calculations, especially for running totals and moving averages.</li>
            </ul>
            <h3 id="advanced-window-function-features">Advanced Window Function Features</h3>
            <ul>
                <li><strong>Frame Specifications</strong>: Define dynamic ranges for window functions to perform calculations like moving averages, cumulative sums, etc.</li>
            </ul>
            <p>
            <div>
                <pre><code class="language-sql">SUM(Quantity) OVER (
      PARTITION BY ProductID
      ORDER BY SaleDate
      ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING
  ) AS SumQuantity</code></pre>
            </div>
            </p>
            <ul>
                <li><strong>Multiple Partitioning and Ordering</strong>: Combine multiple columns in <code>PARTITION BY</code> and <code>ORDER BY</code> for more granular control.</li>
            </ul>
            <p>
            <div>
                <pre><code class="language-sql">ROW_NUMBER() OVER (
      PARTITION BY Category, SubCategory
      ORDER BY SaleDate DESC
  ) AS RowNum</code></pre>
            </div>
            </p>
            <ul>
                <li><strong>Using <code>RANGE</code> Instead of <code>ROWS</code></strong>: Define frames based on logical ranges rather than physical row counts.</li>
            </ul>
            <p>
            <div>
                <pre><code class="language-sql">AVG(Price) OVER (
      PARTITION BY ProductID
      ORDER BY SaleDate
      RANGE BETWEEN INTERVAL '7' DAY PRECEDING AND CURRENT ROW
  ) AS WeeklyAveragePrice</code></pre>
            </div>
            </p>
            <h3 id="example-use-case-sales-trend-analysis">Example Use Case: Sales Trend Analysis</h3>
            <p>Suppose you want to analyze sales trends by calculating the percentage change in quantity compared to the previous sale for each product.</p>
            <p>
            <div>
                <pre><code class="language-sql">SELECT
    SaleID,
    ProductID,
    SaleDate,
    Quantity,
    Price,
    LAG(Quantity) OVER (PARTITION BY ProductID ORDER BY SaleDate) AS PreviousQuantity,
    CASE 
        WHEN LAG(Quantity) OVER (PARTITION BY ProductID ORDER BY SaleDate) IS NULL THEN NULL
        ELSE ((Quantity - LAG(Quantity) OVER (PARTITION BY ProductID ORDER BY SaleDate)) * 100.0) / LAG(Quantity) OVER (PARTITION BY ProductID ORDER BY SaleDate)
    END AS PercentageChange
FROM
    Sales
ORDER BY
    ProductID,
    SaleDate;</code></pre>
            </div>
            </p>
            <p><strong>Result</strong></p>
            <p>
            <table>
                <tr>
                    <td>SaleID</td>
                    <td>ProductID</td>
                    <td>SaleDate</td>
                    <td>Quantity</td>
                    <td>Price</td>
                    <td>PreviousQuantity</td>
                    <td>PercentageChange</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>2024-01-05</td>
                    <td>10</td>
                    <td>15.00</td>
                    <td>NULL</td>
                    <td>NULL</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>101</td>
                    <td>2024-01-10</td>
                    <td>20</td>
                    <td>15.00</td>
                    <td>10</td>
                    <td>100.00</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>101</td>
                    <td>2024-01-20</td>
                    <td>15</td>
                    <td>15.00</td>
                    <td>20</td>
                    <td>-25.00</td>
                </tr>
                <tr>
                    <td>11</td>
                    <td>101</td>
                    <td>2024-01-25</td>
                    <td>NULL</td>
                    <td>15.00</td>
                    <td>15</td>
                    <td>-100.00</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>102</td>
                    <td>2024-01-07</td>
                    <td>5</td>
                    <td>25.00</td>
                    <td>NULL</td>
                    <td>NULL</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>102</td>
                    <td>2024-01-15</td>
                    <td>10</td>
                    <td>25.00</td>
                    <td>5</td>
                    <td>100.00</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>102</td>
                    <td>2024-01-28</td>
                    <td>8</td>
                    <td>25.00</td>
                    <td>10</td>
                    <td>-20.00</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>103</td>
                    <td>2024-01-12</td>
                    <td>7</td>
                    <td>30.00</td>
                    <td>NULL</td>
                    <td>NULL</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>103</td>
                    <td>2024-01-22</td>
                    <td>5</td>
                    <td>30.00</td>
                    <td>7</td>
                    <td>-28.57</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>104</td>
                    <td>2024-01-25</td>
                    <td>12</td>
                    <td>20.00</td>
                    <td>NULL</td>
                    <td>NULL</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>104</td>
                    <td>2024-01-30</td>
                    <td>10</td>
                    <td>20.00</td>
                    <td>12</td>
                    <td>-16.67</td>
                </tr>
            </table>
            </p>
            <ul>
                <li>This query calculates the percentage change in <code>Quantity</code> compared to the previous sale for each <code>ProductID</code>.</li>
                <li>Useful for identifying trends, growth, or decline in sales over time.</li>
            </ul>
        </section>
        <div id="table-of-contents">
            <h2>Table of Contents</h2>
            <ol><a href="#window-functions-in-sql">Window Functions in SQL</a>
                <ol>
                    <li><a href="#common-window-functions">Common Window Functions</a></li>
                    <li><a href="#setting-up-example-tables">Setting Up Example Tables</a></li>
                    <li><a href="#understanding-the-over-clause">Understanding the OVER Clause</a></li>
                    <li><a href="#row_number-function">ROW_NUMBER Function</a>
                        <ol>
                            <li><a href="#example-assigning-row-numbers-to-sales-per-product">Example: Assigning Row Numbers to Sales per Product</a></li>
                        </ol>
                    </li>
                    <li><a href="#rank-and-dense_rank-functions">RANK and DENSE_RANK Functions</a>
                        <ol>
                            <li><a href="#example-ranking-sales-by-quantity-per-product">Example: Ranking Sales by Quantity per Product</a></li>
                        </ol>
                    </li>
                    <li><a href="#ntile-function">NTILE Function</a>
                        <ol>
                            <li><a href="#example-dividing-sales-into-quartiles-per-product">Example: Dividing Sales into Quartiles per Product</a></li>
                        </ol>
                    </li>
                    <li><a href="#lead-and-lag-functions">LEAD and LAG Functions</a>
                        <ol>
                            <li><a href="#example-comparing-current-sale-with-previous-sale-quantity-per-product">Example: Comparing Current Sale with Previous Sale Quantity per Product</a></li>
                        </ol>
                    </li>
                    <li><a href="#aggregate-window-functions">Aggregate Window Functions</a>
                        <ol>
                            <li><a href="#example-calculating-running-total-of-sales-amount-per-product">Example: Calculating Running Total of Sales Amount per Product</a></li>
                        </ol>
                    </li>
                    <li><a href="#handling-null-values-in-window-functions">Handling NULL Values in Window Functions</a>
                        <ol>
                            <li><a href="#example-assigning-row-numbers-with-null-quantities">Example: Assigning Row Numbers with NULL Quantities</a></li>
                        </ol>
                    </li>
                    <li><a href="#practical-tips-for-using-window-functions">Practical Tips for Using Window Functions</a></li>
                    <li><a href="#window-functions-vs-aggregate-functions">Window Functions vs. Aggregate Functions</a>
                        <ol>
                            <li><a href="#example-comparing-aggregate-and-window-functions">Example: Comparing Aggregate and Window Functions</a></li>
                        </ol>
                    </li>
                    <li><a href="#combining-multiple-window-functions">Combining Multiple Window Functions</a>
                        <ol>
                            <li><a href="#example-sales-analysis-with-multiple-window-functions">Example: Sales Analysis with Multiple Window Functions</a></li>
                        </ol>
                    </li>
                    <li><a href="#window-frames">Window Frames</a>
                        <ol>
                            <li><a href="#example-calculating-a-moving-average-of-quantity">Example: Calculating a Moving Average of Quantity</a></li>
                        </ol>
                    </li>
                    <li><a href="#practical-use-cases-for-window-functions">Practical Use Cases for Window Functions</a></li>
                    <li><a href="#combining-window-functions-with-other-sql-features">Combining Window Functions with Other SQL Features</a>
                        <ol>
                            <li><a href="#example-identifying-top-2-sales-per-product">Example: Identifying Top 2 Sales per Product</a></li>
                        </ol>
                    </li>
                    <li><a href="#comparing-window-functions-with-self-joins">Comparing Window Functions with Self-Joins</a>
                        <ol>
                            <li><a href="#example-using-window-functions-vs-self-joins-to-compare-current-and-previous-sales">Example: Using Window Functions vs. Self-Joins to Compare Current and Previous Sales</a></li>
                        </ol>
                    </li>
                    <li><a href="#limitations-and-considerations">Limitations and Considerations</a></li>
                    <li><a href="#advanced-window-function-features">Advanced Window Function Features</a></li>
                    <li><a href="#example-use-case-sales-trend-analysis">Example Use Case: Sales Trend Analysis</a></li>
                </ol>
            </ol>
            <div id="related-articles">
                <h2>Related Articles</h2>
                <ol>
                    <li>Introduction to Databases<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/01_introduction_to_databases/01_databases_intro.html">Databases Intro</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/01_introduction_to_databases/02_types_of_databases.html">Types of Databases</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/01_introduction_to_databases/03_database_management_systems_dbms_.html">Database Management Systems Dbms</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/01_introduction_to_databases/04_data_models.html">Data Models</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/01_introduction_to_databases/05_glossary.html">Glossary</a></li>
                        </ol>
                    </li>
                    <li>Database Design<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/02_database_design/01_requirements_analysis.html">Requirements Analysis</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/02_database_design/02_normalization.html">Normalization</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/02_database_design/03_denormalization.html">Denormalization</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/02_database_design/04_indexing_strategies.html">Indexing Strategies</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/02_database_design/05_data_integrity.html">Data Integrity</a></li>
                        </ol>
                    </li>
                    <li>Sql<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/01_intro_to_sql.html">Intro to Sql</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/02_data_definition_language_ddl.html">Data Definition Language Ddl</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/03_data_manipulation_language_dml.html">Data Manipulation Language Dml</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/04_data_control_language_dcl.html">Data Control Language Dcl</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/05_transaction_control_language_tcl.html">Transaction Control Language Tcl</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/06_joins_subqueries_and_views.html">Joins Subqueries and Views</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/07_stored_procedures_and_functions.html">Stored Procedures and Functions</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/08_triggers.html">Triggers</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/09_hierarchical_data.html">Hierarchical Data</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/10_aggregate_functions.html">Aggregate Functions</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/03_sql/11_window_functions.html">Window Functions</a></li>
                        </ol>
                    </li>
                    <li>Acid Properties and Transactions<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/04_acid_properties_and_transactions/01_transactions_intro.html">Transactions Intro</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/04_acid_properties_and_transactions/02_atomicity.html">Atomicity</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/04_acid_properties_and_transactions/03_consistency.html">Consistency</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/04_acid_properties_and_transactions/04_isolation.html">Isolation</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/04_acid_properties_and_transactions/05_durability.html">Durability</a></li>
                        </ol>
                    </li>
                    <li>Storage and Indexing<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/05_storage_and_indexing/01_how_tables_and_indexes_are_stored_on_disk.html">How Tables and Indexes Are Stored on Disk</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/05_storage_and_indexing/02_row_based_vs_column_based_databases.html">Row Based vs Column Based Databases</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/05_storage_and_indexing/03_primary_key_vs_secondary_key.html">Primary Key vs Secondary Key</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/05_storage_and_indexing/04_database_pages.html">Database Pages</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/05_storage_and_indexing/05_indexing.html">Indexing</a></li>
                        </ol>
                    </li>
                    <li>Distributed Databases<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/01_distributed_database_systems.html">Distributed Database Systems</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/02_partitioning.html">Partitioning</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/03_sharding.html">Sharding</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/04_partitioning_vs_sharding.html">Partitioning vs Sharding</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/05_consistent_hashing.html">Consistent Hashing</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/06_cap_theorem.html">Cap Theorem</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/06_distributed_databases/07_eventual_consistency.html">Eventual Consistency</a></li>
                        </ol>
                    </li>
                    <li>Concurrency Control<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/01_shared_vs_exclusive_locks.html">Shared vs Exclusive Locks</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/02_deadlocks.html">Deadlocks</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/03_two_phase_locking.html">Two Phase Locking</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/04_double_booking_problem.html">Double Booking Problem</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/05_serializable_vs_repeatable_read.html">Serializable vs Repeatable Read</a></li>
                        </ol>
                    </li>
                    <li>Database Performance<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/01_query_optimization_techniques.html">Query Optimization Techniques</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/02_indexing_strategies.html">Indexing Strategies</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/03_database_caching.html">Database Caching</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/04_materialized_views.html">Materialized Views</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/05_accessing_database_in_code.html">Accessing Database in Code</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/08_database_performance/06_working_with_billion_row_table.html">Working with Billion Row Table</a></li>
                        </ol>
                    </li>
                    <li>Database Replication<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/09_database_replication/01_intro_to_replication.html">Intro to Replication</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/09_database_replication/02_master_standby_replication.html">Master Standby Replication</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/09_database_replication/03_multi_master_replication.html">Multi Master Replication</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/09_database_replication/04_synchronous_vs_asynchronous_replication.html">Synchronous vs Asynchronous Replication</a></li>
                        </ol>
                    </li>
                    <li>Nosql Databases<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/10_nosql_databases/01_nosql_databases_intro.html">Nosql Databases Intro</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/10_nosql_databases/02_types_of_nosql_databases.html">Types of Nosql Databases</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/10_nosql_databases/03_querying_nosql_databases.html">Querying Nosql Databases</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/10_nosql_databases/04_crud_in_sql_vs_nosql.html">Crud in Sql vs Nosql</a></li>
                        </ol>
                    </li>
                    <li>Security Best Practices<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/01_backup_and_recovery_strategies.html">Backup and Recovery Strategies</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/02_database_security.html">Database Security</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/03_capacity_planning.html">Capacity Planning</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/04_database_migration.html">Database Migration</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/05_performance_monitoring_and_tuning.html">Performance Monitoring and Tuning</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/06_sql_injection.html">Sql Injection</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/11_security_best_practices/07_crash_recovery_in_databases.html">Crash Recovery in Databases</a></li>
                        </ol>
                    </li>
                    <li>Database Engines<ol>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/01_sqlite.html">Sqlite</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/02_mysql.html">Mysql</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/03_postgresql.html">Postgresql</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/04_mongodb.html">Mongodb</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/05_neo4j.html">Neo4J</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/06_aws_services.html">Aws Services</a></li>
                            <li><a href="https://adamdjellouli.com/articles/databases_notes/12_database_engines/07_choosing_database.html">Choosing Database</a></li>
                        </ol>
                    </li>
                </ol>
            </div>
        </div>
    </div>
    <footer>
        <div class="footer-columns">
            <div class="footer-column">
                <img alt="Adam Djellouli Symbol" src="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/symbol.png" />
            </div>
            <div class="footer-column">
                <h2><a href="https://adamdjellouli.com/core/privacy_policy.html" title="Privacy Policy">Our Privacy Policy</a></h2>
                <p>
                    Thank you for visiting my personal website. All of the <br />
                    content on this site is free to use, but please remember <br />
                    to be a good human being and refrain from any abuse<br />
                    of the site. If you would like to contact me, please use <br />
                    my <a href="https://www.linkedin.com/in/adam-djellouli-1bb54619a/" title="LinkedIn Profile">LinkedIn profile</a> or my <a href="https://github.com/djeada" title="GitHub Profile">GitHub</a> if you have any technical <br />
                    issues or ideas to share. I wish you the best and hope you <br />
                    have a fantastic life. <br />
                </p>
            </div>
            <div class="footer-column">
                <h2>Follow me</h2>
                <ul class="social-media">
                    <li>
                        <a class="fa fa-youtube" href="https://www.youtube.com/channel/UCGPoHTVjMN77wcGknXPHl1Q" target="_blank" title="YouTube">
                        </a>YouTube
                    </li>
                    <li>
                        <a class="fa fa-linkedin" href="https://www.linkedin.com/in/adam-djellouli-1bb54619a/" target="_blank" title="LinkedIn">
                        </a>LinkedIn
                    </li>
                    <li>
                        <a class="fa fa-instagram" href="https://www.instagram.com/linuxchallenges/" target="_blank" title="Instagram">
                        </a>Instagram
                    </li>
                    <li>
                        <a class="fa fa-github" href="https://github.com/djeada" title="GitHub">
                        </a>Github
                    </li>
                </ul>
            </div>
        </div>
        <div>
            <p id="copyright">
                Â© Adam Djellouli. All rights reserved.
            </p>
        </div>
        <script>
            document.getElementById("copyright").innerHTML = "&copy; " + new Date().getFullYear() + " Adam Djellouli. All rights reserved.";
        </script>
        <script src="../../../app.js"></script>
    </footer>
    <div id="pdf-spinner-overlay">
        <div class="spinner"></div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-cpp.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
jax: ["input/TeX", "output/HTML-CSS"],
extensions: ["tex2jax.js"],
"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] },
tex2jax: { inlineMath: [ ["$", "$"] ], displayMath: [ ["$$","$$"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
TeX: { noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } } },
messageStyle: "none"
});
</script>
<script async="" id="MathJax-script" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>

</html>