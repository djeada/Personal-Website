<!DOCTYPE html>

<html lang="en">

<head>
    <script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5593122079896089"></script>
    <meta charset="utf-8" />
    <title>Git internals</title>
    <meta content="Git stores your project as a graph of immutable objects." name="description" />
    <meta content="Adam Djellouli" name="author" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <link crossorigin="" href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/themes/prism.min.css" rel="stylesheet" />
    <link href="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/icon.ico" rel="icon" />
    <link href="../../resources/style.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>
    <nav aria-label="Main navigation">
        <a class="logo" href="../../index.html">
            <img alt="Adam Djellouli - Home Page Logo" id="logo-image" src="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/logo.PNG" />
        </a>
        <input aria-label="Toggle navigation menu" id="navbar-toggle" type="checkbox" />
        <ul aria-labelledby="navbar-toggle" role="menu">
            <li role="menuitem">
                <a href="../../index.html" title="Go to Home Page"> Home </a>
            </li>
            <li role="menuitem">
                <a href="../../core/blog.html" title="Read Adam Djellouli Blog on Programming and Technology"> Blog </a>
            </li>
            <li role="menuitem">
                <a href="../../core/tools.html" title="Discover Tools Created by Adam Djellouli"> Tools </a>
            </li>
            <li role="menuitem">
                <a href="../../core/projects.html" title="Explore Projects Developed by Adam Djellouli"> Projects </a>
            </li>
            <li role="menuitem">
                <a href="../../core/courses.html" title="Browse Courses by Adam Djellouli"> Courses </a>
            </li>
            <li role="menuitem">
                <a href="../../core/resume.html" title="View Adam Djellouli Professional Resume"> Resume </a>
            </li>
            <li>
                <script async="" src="https://cse.google.com/cse.js?cx=8160ef9bb935f4f68"></script>
                <div class="gcse-search"></div>
            </li>
            <li>
                <button aria-label="Toggle dark mode" id="dark-mode-button"></button>
            </li>
        </ul>
    </nav>
    <div id="article-wrapper"><article-section id="article-body">
            <div class="article-action-buttons"><button class="btn-suggest-edit" title="Suggest Edit">
                    <svg fill="none" height="20" viewbox="0 0 24 24" width="20">
                        <path d="M4 21h4l11-11-4-4L4 17v4z" stroke="currentColor" stroke-width="2"></path>
                    </svg>
                </button><button class="btn-create-issue" title="Create Issue">
                    <svg fill="none" height="20" viewbox="0 0 24 24" width="20">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"></circle>
                        <line stroke="currentColor" stroke-width="2" x1="12" x2="12" y1="8" y2="12"></line>
                        <circle cx="12" cy="16" fill="currentColor" r="1"></circle>
                    </svg>
                </button><button class="btn-download" title="Download">
                    <svg fill="none" height="20" viewbox="0 0 24 24" width="20">
                        <path d="M12 5v14m0 0l-6-6m6 6l6-6" stroke="currentColor" stroke-width="2"></path>
                    </svg>
                </button></div>
            <p style="text-align: right;"><i>Last modified: October 19, 2020</i></p>
            <p style="text-align: right;"><i>This article is written in: ğŸ‡ºğŸ‡¸</i></p>
            <h2 id="git-internals">Git internals</h2>
            <p>Git stores your project as a graph of immutable objects. At the leaves are blobs: raw file contents with no filenames attached. Trees sit above blobs and act like directories; a tree is just a list that maps a filename and a mode to either another tree (subfolder) or a blob (file). Commits point to exactly one top-level treeâ€”the snapshot of the entire project at that momentâ€”plus zero or more parents (for merges), and some who/when/why metadata. Refs like <code>main</code> or <code>v1.2.0</code> are just human-friendly names that point at a commitâ€™s ID. HEAD is a tiny text file telling Git which ref you have checked out. The magic is that object IDs are content-hashes, so if two files have identical bytes, they share the same blob; if a folder hasnâ€™t changed, its tree can be reused; if nothing changed, the commit points at the same tree as before. Thatâ€™s how Git is both space-efficient and lightning fast: reuse everywhere, append-only history, and lookups by hash.</p>
            <p>Inside <code>.git/</code>, everything supports that model. Youâ€™ll see <code>objects/</code> holding the database (loose files at first, later packed into <code>.pack</code> files), <code>refs/</code> holding branch and tag pointers, <code>HEAD</code> pointing to the current branch, an <code>index</code> file acting as a staging area, and logs that remember where refs used to point (your safety net). Git never edits a blob or tree in place; it writes a brand-new object, then flips a pointer. Thatâ€™s why operations feel atomic and why you can always walk backward. Think of it like Lego: blobs are bricks, trees are plates arranging bricks by name, commits are photos of the model with notes about who built itâ€”Git keeps every photo and never scribbles on an old one.</p>
            <div>
                <pre><code class="language-shell">Objects (content-addressed)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
file â†’  â”‚   blob     â”‚  (bytes only)
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚ referenced by name+mode
        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
folderâ†’ â”‚   tree     â”‚  (entries: mode, type, hash, name)
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚ root tree of snapshot
        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
history â”‚  commit    â”‚  (tree, parents, author, message)
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

names:
HEAD â†’ refs/heads/main â†’ &lt;commit&gt;

storage:
.git/
  HEAD
  index
  objects/
    12/34abcd...   (loose objects)
    pack/pack-xxxx.{pack,idx}
  refs/
    heads/main
    tags/v1.2.0
  logs/refs/heads/main  (reflog)</code></pre>
            </div>
            <h3 id="walk-the-objects-by-hand-tiny-repo-lab-">Walk the objects by hand (tiny repo lab)</h3>
            <div>
                <pre><code class="language-bash"># start clean
mkdir toy &amp;&amp; cd toy
git init
# output:
# Initialized empty Git repository in .../toy/.git/</code></pre>
            </div>
            <p>Create a file and inspect what gets stored.</p>
            <div>
                <pre><code class="language-bash">echo "hello world" &gt; hello.txt
git status
# output:
# Untracked files:
#   hello.txt</code></pre>
            </div>
            <p>Stage it; staging writes a blob object and records its hash in the index.</p>
            <div>
                <pre><code class="language-bash">git add hello.txt

# See whatâ€™s staged and the blob ID behind it
git ls-files -s
# output (mode | stage | blob-hash | path):
# 100644 &lt;blob-hash&gt; 0	hello.txt
# (your hash will differ)</code></pre>
            </div>
            <p>Peek at the blob (raw file content, no filename inside):</p>
            <div>
                <pre><code class="language-bash">git cat-file -t &lt;blob-hash&gt;
# output:
# blob

git cat-file -p &lt;blob-hash&gt;
# output:
# hello world</code></pre>
            </div>
            <p>Write the first tree from the index and look inside it.</p>
            <div>
                <pre><code class="language-bash">git write-tree
# output:
# &lt;tree-hash&gt;

git cat-file -p &lt;tree-hash&gt;
# output (mode type   hash                                   name):
# 100644 blob  &lt;blob-hash&gt;    hello.txt</code></pre>
            </div>
            <p>Make a commit that points at that tree.</p>
            <div>
                <pre><code class="language-bash">git commit-tree &lt;tree-hash&gt; -m "initial snapshot"
# output:
# &lt;commit-hash&gt;

# Move the branch name to that commit
git update-ref refs/heads/main &lt;commit-hash&gt;
echo "ref: refs/heads/main" &gt; .git/HEAD</code></pre>
            </div>
            <p>Read the commit object:</p>
            <div>
                <pre><code class="language-bash">git cat-file -p &lt;commit-hash&gt;
# output (example):
# tree &lt;tree-hash&gt;
# author You &lt;you@example.com&gt; 1699999999 +0000
# committer You &lt;you@example.com&gt; 1699999999 +0000
#
# initial snapshot</code></pre>
            </div>
            <p>Now use the regular porcelain to keep going.</p>
            <div>
                <pre><code class="language-bash"># Add another file and commit it the normal way
echo "bye" &gt; bye.txt
git add bye.txt
git commit -m "add bye"
# output:
# [main 9f3a1c2] add bye
#  1 file changed, 1 insertion(+)
#  create mode 100644 bye.txt</code></pre>
            </div>
            <p>See the new snapshotâ€™s tree and all filesâ€™ blob hashes.</p>
            <div>
                <pre><code class="language-bash">git ls-tree -r HEAD
# output:
# 100644 blob &lt;hash1&gt;    bye.txt
# 100644 blob &lt;hash2&gt;    hello.txt

git cat-file -p HEAD^{tree}
# output:
# 100644 blob &lt;hash1&gt;    bye.txt
# 100644 blob &lt;hash2&gt;    hello.txt</code></pre>
            </div>
            <p>Show how commits stitch together.</p>
            <div>
                <pre><code class="language-bash">git log --oneline --graph --decorate
# output:
# * 9f3a1c2 (HEAD -&gt; main) add bye
# * a1b2c3d initial snapshot</code></pre>
            </div>
            <p>Peek at pointers on disk.</p>
            <div>
                <pre><code class="language-bash">cat .git/HEAD
# output:
# ref: refs/heads/main

cat .git/refs/heads/main
# output:
# 9f3a1c2...   (the commit ID for main)</code></pre>
            </div>
            <p>A picture of what you just built:</p>
            <div>
                <pre><code class="language-shell">refs/heads/main â”€â”€â–º (commit 9f3a1c2)
                      â”‚
                      â”œâ”€ tree T2 (root)
                      â”‚    â”œâ”€ 100644 blob &lt;hash1&gt;  bye.txt
                      â”‚    â””â”€ 100644 blob &lt;hash2&gt;  hello.txt
                      â”‚
                      â””â”€ parent (commit a1b2c3d)
                           â””â”€ tree T1 with only hello.txt</code></pre>
            </div>
            <h3 id="what-the-index-staging-area-really-holds">What the index (staging area) really holds</h3>
            <p>The index is a compact table: for each path, it stores mode, blob hash, and some metadata. Thatâ€™s why â€œstaged vs unstagedâ€ is so fastâ€”Git compares your working tree to the index, not to HEAD, and it can build a tree object directly from the index during commit.</p>
            <div>
                <pre><code class="language-bash">git ls-files --stage
# output (mode stage hash path):
# 100644 0 &lt;hash1&gt; bye.txt
# 100644 0 &lt;hash2&gt; hello.txt</code></pre>
            </div>
            <p>Stages other than <code>0</code> appear during merges to hold multiple versions of the same path (thatâ€™s how Git presents conflict hunks).</p>
            <h3 id="loose-objects-vs-packfiles-storage-evolution-">Loose objects vs packfiles (storage evolution)</h3>
            <p>New objects start life as compressed files under <code>.git/objects/aa/bb...</code> where <code>aa</code> is the first two hex digits of the ID. Over time Git packs many objects into a single <code>.pack</code> file for space and speed; an accompanying <code>.idx</code> lets it locate an object quickly.</p>
            <div>
                <pre><code class="language-bash"># Count loose objects
find .git/objects -type f | wc -l
# output (small number initially)

# Pack them
git gc
# output:
# Counting objects: ...
# Writing objects: ...
# Total ..., reused ...

# See the packs
ls .git/objects/pack
# output:
# pack-1234abcd.pack
# pack-1234abcd.idx</code></pre>
            </div>
            <p>ASCII of that progression:</p>
            <div>
                <pre><code class="language-shell">loose:
.git/objects/
  ab/cdef...   (one file per object)
  12/3456...

packed:
.git/objects/pack/
  pack-xxxx.pack   (many objects)
  pack-xxxx.idx    (index for lookups)</code></pre>
            </div>
            <h3 id="names-are-in-trees-not-blobs-why-dedup-works-">Names are in trees, not blobs (why dedup works)</h3>
            <p>Two files with identical bytes anywhere in history share the same blob ID. Filenames and execute bits live in trees, so renames donâ€™t rewrite blobs; Git just updates the tree entry to point the same blob under a new name.</p>
            <div>
                <pre><code class="language-bash">cp hello.txt copy.txt
git add copy.txt
git ls-tree -r HEAD
# output (notice identical blob hash for both paths):
# 100644 blob &lt;hash2&gt; copy.txt
# 100644 blob &lt;hash2&gt; hello.txt</code></pre>
            </div>
            <h3 id="tags-anchor-names-to-objects-annotated-vs-lightweight-">Tags anchor names to objects (annotated vs lightweight)</h3>
            <p>Tags are refs too; annotated tags are objects with their own metadata and a pointer to another object (usually a commit). Lightweight tags are just a name pointing straight to a commit.</p>
            <div>
                <pre><code class="language-bash">git tag -a v1.0 -m "first release"
git cat-file -p refs/tags/v1.0
# output:
# object &lt;commit-hash&gt;
# type commit
# tag v1.0
# tagger You &lt;you@example.com&gt; ...
#
# first release</code></pre>
            </div>
            <h3 id="quick-x-ray-recipes-you-ll-use">Quick â€œx-rayâ€ recipes youâ€™ll use</h3>
            <div>
                <pre><code class="language-bash"># Show the type/size/pretty of any object by hash
git cat-file -t &lt;id&gt;
git cat-file -s &lt;id&gt;
git cat-file -p &lt;id&gt;

# Show exactly which tree/parent(s) a commit has
git show --no-patch --pretty=raw HEAD

# Map paths to blob hashes at a commit (great for checksums)
git ls-tree -r --long HEAD

# Compare two trees without touching the working dir
git diff --name-status &lt;commitA&gt;^{tree} &lt;commitB&gt;^{tree}</code></pre>
            </div>
            <h3 id="mental-model-to-keep">Mental model to keep</h3>
            <p>Blobs are bytes. Trees give names to blobs (and trees). Commits name a tree and connect it to parents. Refs name commits so humans donâ€™t have to memorize hashes. The <code>.git/</code> folder is the whole universe: a content-addressed object store, a few tiny pointers, and logs. Everything else is a view on those pieces.</p>
        </article-section>
        <div id="table-of-contents">
            <h2>Table of Contents</h2>
            <ol><a href="#git-internals">Git internals</a>
                <ol>
                    <li><a href="#walk-the-objects-by-hand-tiny-repo-lab-">Walk the objects by hand (tiny repo lab)</a></li>
                    <li><a href="#what-the-index-staging-area-really-holds">What the index (staging area) really holds</a></li>
                    <li><a href="#loose-objects-vs-packfiles-storage-evolution-">Loose objects vs packfiles (storage evolution)</a></li>
                    <li><a href="#names-are-in-trees-not-blobs-why-dedup-works-">Names are in trees, not blobs (why dedup works)</a></li>
                    <li><a href="#tags-anchor-names-to-objects-annotated-vs-lightweight-">Tags anchor names to objects (annotated vs lightweight)</a></li>
                    <li><a href="#quick-x-ray-recipes-you-ll-use">Quick â€œx-rayâ€ recipes youâ€™ll use</a></li>
                    <li><a href="#mental-model-to-keep">Mental model to keep</a></li>
                </ol>
            </ol>
            <div id="related-articles">
                <h2>Related Articles</h2>
                <ol>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/01_introduction_to_version_control.html">Introduction to Version Control</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/02_create_repository.html">Create Repository</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/03_making_changes.html">Making Changes</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/04_working_with_branches.html">Working with Branches</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/05_head.html">Head</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/06_tags.html">Tags</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/07_stashing_files.html">Stashing Files</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/08_observing_repository.html">Observing Repository</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/09_synchronization.html">Synchronization</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/10_squashing_commits.html">Squashing Commits</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/11_archive.html">Archive</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/12_git_server.html">Git Server</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/13_points_of_confusion.html">Points of Confusion</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/14_branching_strategies.html">Branching Strategies</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/15_mono_and_multi_repo.html">Mono and Multi Repo</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/16_dangerous_commands.html">Dangerous Commands</a></li>
                    <li><a href="https://adamdjellouli.com/articles/git_notes/17_git_internals.html">Git Internals</a></li>
                </ol>
            </div>
        </div>
    </div>
    <footer>
        <div class="footer-columns">
            <div class="footer-column">
                <img alt="Adam Djellouli Symbol" src="https://raw.githubusercontent.com/djeada/Personal-Website/master/images/symbol.png" />
            </div>
            <div class="footer-column">
                <h2><a href="https://adamdjellouli.com/core/privacy_policy.html" title="Privacy Policy">Our Privacy Policy</a></h2>
                <p>Thank you for visiting my personal website. All content here is free to use, but please remember to be respectful and avoid any misuse of the site. If youâ€™d like to get in touch, feel free to reach out via my <a href="https://www.linkedin.com/in/adam-djellouli-1bb54619a/" title="LinkedIn Profile">LinkedIn profile</a> or connect with me on <a href="https://github.com/djeada" title="GitHub Profile">GitHub</a> if you have technical questions or ideas to share. Wishing you all the best and a fantastic life ahead!</p>
            </div>
            <div class="footer-column">
                <h2>Follow me</h2>
                <ul class="social-media">
                    <li>
                        <a class="fa fa-youtube" href="https://www.youtube.com/channel/UCGPoHTVjMN77wcGknXPHl1Q" target="_blank" title="YouTube">
                        </a>YouTube
                    </li>
                    <li>
                        <a class="fa fa-linkedin" href="https://www.linkedin.com/in/adam-djellouli-1bb54619a/" target="_blank" title="LinkedIn">
                        </a>LinkedIn
                    </li>
                    <li>
                        <a class="fa fa-instagram" href="https://www.instagram.com/linuxchallenges/" target="_blank" title="Instagram">
                        </a>Instagram
                    </li>
                    <li>
                        <a class="fa fa-github" href="https://github.com/djeada" title="GitHub">
                        </a>Github
                    </li>
                </ul>
            </div>
        </div>
        <div>
            <p id="copyright">
                Â© Adam Djellouli. All rights reserved.
            </p>
        </div>
        <script>
            document.getElementById("copyright").innerHTML = "&copy; " + new Date().getFullYear() + " Adam Djellouli. All rights reserved.";
        </script>
        <script src="../../app.js"></script>
    </footer>
    <div id="pdf-spinner-overlay">
        <div class="spinner"></div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-cpp.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
jax: ["input/TeX", "output/HTML-CSS"],
extensions: ["tex2jax.js"],
"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] },
tex2jax: { inlineMath: [ ["$", "$"] ], displayMath: [ ["$$","$$"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
TeX: { noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } } },
messageStyle: "none"
});
</script>
<script async="" id="MathJax-script" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>

</html>